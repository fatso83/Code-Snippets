(function(window,$,undefined){function MYK(){}window.myk=new MYK();
})(window,jQuery);
function Ajax(strURL){this.url=strURL;
this.isCancellable=true;
this.failureCallback="";
this.requiresMimeOverride=navigator.userAgent.indexOf("Firefox/1.0")>-1;
this.randomID=this.randomID||new Date().getTime();
}Ajax.prototype.makeRequest=function(strParam,successCallback,failCallback){var separator=strParam&&strParam!=""?"&":"";
this.param=strParam+separator+mykJS.csrfParamsStr;
if(strParam===undefined||strParam.indexOf("isAjax")==-1){this.param=this.param+"&isAjax=1";
}this.successCallback=function(data){if(mykJS.isRequestInvalid(data)){return;
}successCallback(data);
};
if(failCallback){this.failureCallback=failCallback;
}var httpRequest=false;
if(window.XMLHttpRequest){httpRequest=new XMLHttpRequest();
if(this.requiresMimeOverride&&httpRequest.overrideMimeType){httpRequest.overrideMimeType("text/xml");
}}else{if(window.ActiveXObject){try{httpRequest=new ActiveXObject("Msxml2.XMLHTTP");
}catch(e){try{httpRequest=new ActiveXObject("Microsoft.XMLHTTP");
}catch(e){}}}}if(!httpRequest){return false;
}var ajaxObj=this;
httpRequest.onreadystatechange=function(){try{if(httpRequest.readyState==4){if(httpRequest.status==200){var resp=httpRequest.responseText;
try{ajaxObj.successCallback(resp);
}catch(ex){ajaxObj._endRequest("Error using callback ",ex);
return;
}ajaxObj._endRequest();
}else{ajaxObj._endRequest("Error status: "+httpRequest.status+" : "+httpRequest.responseText);
}}}catch(ex){ajaxObj._endRequest("Error with ajax: "+ex);
}};
if(this.requestMethod=="GET"){httpRequest.open("GET",this.url+"?"+this.param+"random="+Ajax.randomID,true);
Ajax.randomID++;
}else{httpRequest.open("POST",this.url,true);
httpRequest.setRequestHeader("Content-Type","application/x-www-form-urlencoded; "+"charset=UTF-8");
}httpRequest.send(this.param);
return true;
};
Ajax.prototype._endRequest=function(errorMsg,sText){if(errorMsg){if(this.failureCallback){this.failureCallback();
}}};
Ajax._requestTimedOut=function(ajaxObj){return function(){if(ajaxObj.isCancellable){ajaxObj.cancel=true;
if(State.currentRequest==ajaxObj){State.currentRequest=null;
}}ajaxObj._endRequest("Request timed out");
if(ajaxObj.failureCallback){ajaxObj.failureCallback();
}};
};
function ajaxRequest(url,input,callback,delay){mykJS.ajaxRequest(url,input,callback,delay);
}(function(window,$,undefined){var AutoComplete=function(){this.prevSearchText="";
this.keyIndex=-1;
this.lastMouseover=null;
this.dropDownLength=0;
};
AutoComplete.prototype.SEARCH_FORM_ID="searchTextId";
AutoComplete.prototype.SEARCH_FORM_NAME="searchText";
AutoComplete.prototype.DROP_DOWN_DIV_ID="autoCompleteDropDown";
AutoComplete.prototype.SEARCH_TEXT_AREA_ID="searchTextId";
AutoComplete.prototype.NUM_CHARS_TO_IGNORE=1;
AutoComplete.prototype.MAX_CHARACTERS_DROP_DOWN=75;
AutoComplete.prototype.MAX_SUGGESTIONS=10;
AutoComplete.prototype.constructAutoCompleteFramework=function(callback){this.createAutoCompleteDiv();
var searchForm=document.getElementById(AutoComplete.prototype.SEARCH_TEXT_AREA_ID);
if(searchForm){UtilitiesEvent.addEvent("keyup",searchForm,this.autoCompleteInputKeyUp);
searchForm.onsubmit=AutoComplete.submit;
}UtilitiesEvent.addEvent("resize",window,AutoComplete.prototype.moveDropDown);
UtilitiesEvent.addEvent("mousedown",document.body,AutoComplete.prototype.undisplay);
jQuery(window).ready(function(){var iframe=document.getElementById("orderList");
if(iframe){if(iframe.contentDocument){UtilitiesEvent.addEvent("mousedown",document.getElementById("orderList").contentDocument.body,AutoComplete.prototype.undisplay);
UtilitiesEvent.addEvent("load",document.getElementById("orderList"),function(){UtilitiesEvent.addEvent("mousedown",document.getElementById("orderList").contentDocument.body,AutoComplete.prototype.undisplay);
});
}else{if(iframe.contentWindow){UtilitiesEvent.addEvent("mousedown",document.getElementById("orderList").contentWindow.document.body,AutoComplete.prototype.undisplay,document.getElementById("orderList").contentWindow);
UtilitiesEvent.addEvent("load",document.getElementById("orderList"),function(){UtilitiesEvent.addEvent("mousedown",document.getElementById("orderList").contentWindow.document.body,AutoComplete.prototype.undisplay,document.getElementById("orderList").contentWindow);
},document.getElementById("orderList").contentWindow);
}else{if(iframe.document){UtilitiesEvent.addEvent("mousedown",document.getElementById("orderList").document.body,AutoComplete.prototype.undisplay);
UtilitiesEvent.addEvent("load",document.getElementById("orderList").document,function(){UtilitiesEvent.addEvent("mousedown",document.getElementById("orderList").document.body,AutoComplete.prototype.undisplay);
});
}}}return;
}});
var searchTextArea=document.getElementById(AutoComplete.prototype.SEARCH_TEXT_AREA_ID);
if(searchTextArea){searchTextArea.setAttribute("autocomplete","off");
}};
AutoComplete.prototype.autoCompleteInputKeyUp=function(event){var keyCode;
if(event){keyCode=event.keyCode;
}else{keyCode=window.event.keyCode;
}var autoCompleteDiv=document.getElementById(AutoComplete.prototype.DROP_DOWN_DIV_ID);
if(!autoCompleteDiv){return;
}if(keyCode==38&&autoCompleteDiv.firstChild!=null){if(AutoComplete.prototype.keyIndex>0){AutoComplete.prototype.keyIndex--;
AutoComplete.prototype.navigateToLine(AutoComplete.prototype.keyIndex);
}else{if(AutoComplete.prototype.keyIndex==0){AutoComplete.prototype.keyIndex=-1;
var searchTextArea=document.getElementById(AutoComplete.prototype.SEARCH_TEXT_AREA_ID);
searchTextArea.value=AutoComplete.prototype.prevSearchText;
searchTextArea.setAttribute("asin","");
AutoComplete.prototype.removeHighlightLine(0);
}}}else{if(keyCode==40&&autoCompleteDiv.firstChild!=null){if(AutoComplete.prototype.keyIndex<AutoComplete.prototype.dropDownLength-1){AutoComplete.prototype.keyIndex++;
}AutoComplete.prototype.navigateToLine(AutoComplete.prototype.keyIndex);
}else{if(keyCode==37||keyCode==39){AutoComplete.prototype.keyIndex=-1;
var searchTextArea=document.getElementById(AutoComplete.prototype.SEARCH_TEXT_AREA_ID);
AutoComplete.prototype.undisplay();
return;
}else{if(keyCode==13){AutoComplete.prototype.submitForm();
}else{AutoComplete.prototype.updateSearch();
}}}}};
AutoComplete.prototype.updateSearch=function(){AutoComplete.prototype.keyIndex=-1;
var searchTextArea=document.getElementById(AutoComplete.prototype.SEARCH_TEXT_AREA_ID);
searchTextArea.setAttribute("asin","");
AutoComplete.prototype.typedKey();
};
AutoComplete.prototype.typedKey=function(){var searchText=document.getElementById(AutoComplete.prototype.SEARCH_FORM_ID).value;
searchText=searchText.replace(/&/g,"&amp;");
searchTextArray=searchText.split("%20");
searchText="";
for(var i=0;
i<searchTextArray.length;
i++){var token=searchTextArray[i];
if(token==""){continue;
}token=token.replace(/%3A/g,":");
token=token.replace(/%2C/g,",");
token=token.replace(/%22/g,'"');
searchText+=token+" ";
}searchText=searchText.substring(0,searchText.length-1);
AutoComplete.prototype.prevSearchText=searchText;
if(searchText.length<=AutoComplete.prototype.NUM_CHARS_TO_IGNORE){AutoComplete.prototype.undisplay();
return;
}var matchingObjectArray=itemCache.getAllMatches(searchText);
if(matchingObjectArray.length<AutoComplete.prototype.MAX_SUGGESTIONS){this.dropDownLength=matchingObjectArray.length;
}else{this.dropDownLength=AutoComplete.prototype.MAX_SUGGESTIONS;
}AutoComplete.prototype.showDropDown(matchingObjectArray,searchText);
};
AutoComplete.prototype.submitForm=function(){AutoComplete.prototype.highlightLine(AutoComplete.prototype.getElementInDropDown(AutoComplete.prototype.keyIndex),true);
AutoComplete.submit();
};
AutoComplete.submit=function(){AutoComplete.prototype.undisplay();
var SEARCH_TEXT_AREA_ID="searchTextId";
var SEARCH_FORM_NAME="searchForm";
var SEARCH_FORM_ID="searchTextId";
var FILTER_SEARCH_ID="filterSearch";
var searchText=document.getElementById(SEARCH_FORM_ID).value;
var searchTextArea=document.getElementById(SEARCH_TEXT_AREA_ID);
var filterSearch=document.getElementById(FILTER_SEARCH_ID);
if(searchText.length==0){var filterSearchVal=filterSearch.options[filterSearch.selectedIndex].id.substring(6);
filterList.filter(filterSearchVal);
searchFor.searchParam=undefined;
return;
}filterList.none();
var asin=searchTextArea.getAttribute("asin");
if(!asin){searchFor.lookup(searchText);
mykJS.log("ro_search","hit");
}else{itemExpand.showAutoSearch(asin);
mykJS.log("ro_cmpt","hit");
}searchTextArea.focus();
};
AutoComplete.prototype.undisplay=function(){var dropDownDiv=parent.document.getElementById(AutoComplete.prototype.DROP_DOWN_DIV_ID);
if(!dropDownDiv){return;
}dropDownDiv.innerHTML="";
dropDownDiv.style.display="none";
};
AutoComplete.prototype.showDropDown=function(matchingArray,searchText){var autoCompleteDiv=document.getElementById(AutoComplete.prototype.DROP_DOWN_DIV_ID);
if(!autoCompleteDiv){return;
}var suggestionsLine="";
var divValueLeft="";
var divValueMiddle="";
var divValueRight="";
var matchLength=searchText.length;
autoCompleteDiv.innerHTML="";
if(matchingArray.length==0){AutoComplete.prototype.undisplay();
return;
}for(var count=0;
count<matchingArray.length&&count<this.MAX_SUGGESTIONS;
count++){var curIndex=matchingArray[count].index;
divValueLeft=matchingArray[count].content.substring(0,curIndex);
divValueMiddle=matchingArray[count].content.substring(curIndex,curIndex+matchLength);
divValueRight=matchingArray[count].content.substring(curIndex+matchLength,matchingArray[count].content.length);
var divValuesObj=AutoComplete.prototype.trimDropDownText(divValueLeft,divValueMiddle,divValueRight);
divValueLeft=divValuesObj.left;
divValueMiddle=divValuesObj.middle;
divValueRight=divValuesObj.right;
var simpleHtmlEscape=function(str){str=str.replace(/&/g,"&amp;");
str=str.replace(/</g,"&lt;");
str=str.replace(/>/g,"&gt;");
str=str.replace(/\"/g,"&quot;");
str=str.replace(/\'/g,"&#39;");
return str;
};
divValueLeft=simpleHtmlEscape(divValueLeft);
divValueMiddle=simpleHtmlEscape(divValueMiddle);
divValueRight=simpleHtmlEscape(divValueRight);
var divValue=matchingArray[count].content;
divValue=simpleHtmlEscape(divValue);
suggestionLine="<div class='suggestion' suggestValue='"+divValue+"' suggestIndex='"+count+"'"+" title='"+divValue.substring(0,200)+"'"+" asin='"+matchingArray[count].asin+"'"+" onmouseover="+"'myk.AutoComplete.prototype.highlightLine( this, false )'"+" onmousedown='myk.AutoComplete.prototype.submitForm( this )'"+">";
suggestionLine+="<span class='suggestionLeft'>"+divValueLeft+"</span>";
suggestionLine+="<span class='suggestionMiddle'>"+divValueMiddle+"</span>";
suggestionLine+="<span class='suggestionRight'>"+divValueRight+"</span>";
suggestionLine+="</div>";
autoCompleteDiv.innerHTML+=suggestionLine;
}AutoComplete.prototype.moveDropDown();
autoCompleteDiv.style.display="block";
};
AutoComplete.prototype.trimDropDownText=function(left,middle,right){var returnObj=new Object;
returnObj.left=left;
returnObj.middle=middle;
returnObj.right=right;
var MAX=AutoComplete.prototype.MAX_CHARACTERS_DROP_DOWN;
var MIN_RIGHT=6;
var totalLength=left.length+middle.length+right.length;
if(totalLength>MAX){if(left.length+middle.length+MIN_RIGHT<=MAX){var maxRightLength=MAX-(left.length+middle.length);
if(right.length==0){returnObj.right="";
}else{returnObj.right=right.substring(0,maxRightLength)+"...";
}}else{if(middle.length+MIN_RIGHT<=MAX){if(right.length==0){returnObj.right="";
}else{returnObj.right=right.substring(0,MIN_RIGHT)+"...";
}var maxLeftLength=MAX-middle.length-MIN_RIGHT;
returnObj.left="...";
if(maxLeftLength>0){returnObj.left+=left.substring(left.length-maxLeftLength,left.length);
}}else{returnObj.left="";
if(right.length==0){returnObj.right="";
}else{returnObj.right=right.substring(0,MIN_RIGHT)+"...";
}returnObj.middle="..."+middle.substring(middle.length-MAX+MIN_RIGHT,middle.length);
}}}return returnObj;
};
AutoComplete.prototype.highlightLine=function(elem,setValue){if(!elem){return;
}if(this.lastMouseover!=null){this.lastMouseover.className="suggestion";
}elem.className="suggestion highlight";
this.lastMouseover=elem;
var textAreaBox=document.getElementById(AutoComplete.prototype.SEARCH_TEXT_AREA_ID);
textAreaBox.setAttribute("asin",elem.getAttribute("asin"));
if(setValue&&setValue==true){textAreaBox.value=elem.getAttribute("suggestValue");
}this.keyIndex=parseInt(elem.getAttribute("suggestIndex"));
};
AutoComplete.prototype.removeHighlightLine=function(index){var elem=this.getElementInDropDown(index);
if(elem){elem.className="suggestion";
}};
AutoComplete.prototype.navigateToLine=function(dropDownIndex){var elem=this.getElementInDropDown(dropDownIndex);
AutoComplete.prototype.highlightLine(elem,false);
};
AutoComplete.prototype.getElementInDropDown=function(dropDownIndex){if(dropDownIndex<0){return;
}var autoCompleteDiv=document.getElementById(AutoComplete.prototype.DROP_DOWN_DIV_ID);
if(!autoCompleteDiv){return;
}var iter=autoCompleteDiv.firstChild;
for(var k=0;
k<dropDownIndex;
k++){iter=iter.nextSibling;
}return iter;
};
AutoComplete.prototype.createAutoCompleteDiv=function(){if(this.autoCompleteDiv){return;
}this.autoCompleteDiv=document.createElement("div");
this.autoCompleteDiv.id=AutoComplete.prototype.DROP_DOWN_DIV_ID;
this.moveDropDown();
this.autoCompleteDiv.style.display="none";
var childToAppend=this.autoCompleteDiv;
jQuery(window).ready(function(){document.body.appendChild(childToAppend);
});
};
AutoComplete.prototype.moveDropDown=function(){var autoCompleteDiv=document.getElementById(AutoComplete.prototype.DROP_DOWN_DIV_ID);
if(!autoCompleteDiv){return;
}var searchInputArea=document.getElementById(AutoComplete.prototype.SEARCH_TEXT_AREA_ID);
autoCompleteDiv.style.top=UtilitiesDom.findYPos(searchInputArea)+17+"px";
autoCompleteDiv.style.left=UtilitiesDom.findXPos(searchInputArea)+"px";
};
myk.AutoComplete=AutoComplete;
})(window,jQuery);
function CreateHTML(){}CreateHTML.selectDeviceBox=function(deviceList,selectBoxAttr){var selectBox=jQuery("<select/>");
selectBox.attr(selectBoxAttr);
for(var i=0;
i<deviceList.length;
i++){var currentDevice=deviceList[i];
var option;
if(currentDevice.excludeDevice===1){option=jQuery('<optgroup label="'+currentDevice.name+'" class="disabledOpt"/>');
}else{option=jQuery('<option value="'+currentDevice.accountID+'">'+currentDevice.name+"</option>");
if(currentDevice.needsUpgrade===1){option.attr("needsupgrade",1);
}}selectBox.append(option);
}return selectBox;
};
var ownedFionas;
var deviceID;
var collapseButton;
var expandButton;
var goButton;
var sendButton;
var sortDsc;
var sortAsc;
var downloadButton;
var loading;
var loadingGrey;
var noImg;
var closeImage;
var totalRows=16;
function dataCache(){this.theData=[];
this.contentLoadingStatus=[];
}dataCache.prototype.getDataByASIN=function(asin){var item;
var returnInfo=[];
for(item in this.theData){if(this.theData[item].asin==asin){returnInfo=this.theData[item];
}}return returnInfo;
};
dataCache.prototype.getAllMatches=function(searchText){if(filterList.getCurrentFilter()==="All"){return this.getMatches(searchText,this.theData);
}else{return this.getMatches(searchText,searchFor.filterResultObjects);
}};
dataCache.prototype.getMatches=function(searchText,dataset){var matches=new Object;
var arrayOfMatchingObjects=new Array();
for(var content in dataset){var authTitl=dataset[content].title+" - "+dataset[content].author;
var matchIndex=authTitl.toLowerCase().indexOf(searchText.toLowerCase());
if(matchIndex!=-1){if(dataset[content].asin){var asin=dataset[content].asin;
if(!matches[asin]){matches[asin]=true;
var arrayObj=new Object;
arrayObj.asin=asin;
arrayObj.content=authTitl;
arrayObj.index=matchIndex;
arrayOfMatchingObjects.push(arrayObj);
}}}}return arrayOfMatchingObjects;
};
function Devices(){this.ownedDeviceList;
this.KCR_DEVICE_TYPE="A2CTZ977SKFQZY";
}Devices.prototype.getDevices=function(devices,capabilities){var fionaDevice=[];
if(!devices[capabilities[0]]||devices[capabilities[0]].length==0){return fionaDevice;
}var temp={};
for(var d in devices[capabilities[0]]){temp[devices[capabilities[0]][d].accountID]=devices[capabilities[0]][d];
}for(var i=1;
i<capabilities.length;
i++){if(!devices[capabilities[i]]||devices[capabilities[i]].length==0){return fionaDevice;
}var temp2={};
for(var d in devices[capabilities[i]]){var accountID=devices[capabilities[i]][d].accountID;
if(accountID in temp){temp2[accountID]=temp[accountID];
}}temp=temp2;
}for(var accountID in temp){fionaDevice.push(temp[accountID]);
}return fionaDevice;
};
Devices.prototype.isKCRById=function(deviceAccountId){var currentDevice=jQuery.map(this.ownedDeviceList,function(device){return device.accountID===deviceAccountId?device:null;
});
if(currentDevice.length>0){return currentDevice[0].deviceType===this.KCR_DEVICE_TYPE;
}else{return 0;
}};
Devices.prototype.isKCRByType=function(deviceType){return deviceType===this.KCR_DEVICE_TYPE;
};
Devices.prototype.removeKCRDevice=function(deviceList){for(var i=0;
i<deviceList.length;
i++){if(this.isKCRByType(deviceList[i].deviceType)){deviceList.splice(i,1);
}}};
Devices.prototype.isKCRIncluded=function(capabilities){var kcr_device_type=this.KCR_DEVICE_TYPE;
var includedDevices=this.getDevices(ownedFionas,capabilities);
includedDevices=jQuery.grep(includedDevices,function(device){return device.deviceType===kcr_device_type;
});
return includedDevices.length===1;
};
Devices.prototype.removeVirtualDevices=function(deviceList){for(var i=0;
i<deviceList.length;
i++){if(deviceList[i].isVirtual){deviceList[i].excludeDevice=1;
}}};
function Expand(){this.isExpanded=0;
this.isLoading=0;
}var canLoan=new Ajax("/gp/digital/fiona/manage/features/order-history/ajax/canLoan.html");
function callBackCanLoan(resp){try{var loanResult=eval("("+resp+")");
var itemData=itemCache.getDataByASIN(loanResult.asin);
var row=loanResult.row;
itemData.canLoan=loanResult.canLoan;
var jqOrdersAction=jQuery("#ordersActions_"+row);
if(itemData.canLoan){var lendingDiv=mykJS.lendThisTitle;
lendingDiv=lendingDiv.replace(/{ASIN}/g,loanResult.asin);
jqOrdersAction.append(jQuery(lendingDiv));
}else{var height=jQuery(".ap_body").height();
jQuery(".ap_body").height(height-25);
}jQuery("#actionsLoading_"+row).hide();
jqOrdersAction.show();
}catch(e){}}var isMobile=false;
if(navigator&&navigator.userAgent&&navigator.userAgent.match(/(iPad|iPod|iPhone)/)){isMobile=true;
}Expand.prototype.isAudible=function(itemData){var category=itemData.category;
if(category.indexOf("aud")==0){return 1;
}};
Expand.prototype.isKDK=function(itemData){var category=itemData.category;
if(category.indexOf("kdk")==0){return 1;
}};
Expand.prototype.isOnLoan=function(itemData){var loanStatus=itemData.loanStatus;
var loanView=itemData.loanView;
return(loanStatus&&loanView=="lender"&&(loanStatus=="FULFILLED"||loanStatus=="PENDING"));
};
Expand.prototype.isBorrowed=function(itemData){var loanStatus=itemData.loanStatus;
var loanView=itemData.loanView;
return(loanStatus&&loanView=="lendee");
};
Expand.prototype.isActiveRental=function(itemData){return(this.isRental(itemData)&&!itemData.rentalExpired);
};
Expand.prototype.updateTable=function(){this.isExpanded=0;
this.collapseAll();
if(searchFor.isSearch){this.showSearchList();
}else{var startItem=(pageList.currentPage-1)*pageList.pageSize;
for(var count=1;
count<=pageList.pageSize&&startItem<pageList.totalItems;
count++){this.populateRow(itemCache.theData[startItem++],count);
}}ykl.showOrderItemsCount();
};
Expand.prototype.populateSearchRows=function(asin,row){ykl.showOrderListTable();
var element;
element=document.getElementById("orderListBody");
var rowid="Row"+row+" collapse";
var collapsedRow=this.generateCollapseBox(asin,row);
collapsedRow.setAttribute("id",rowid);
rowid="Row"+row+" expand";
var expandedRow=document.createElement("tr");
expandedRow.setAttribute("id",rowid);
expandedRow.setAttribute("oID",itemCache.getDataByASIN(asin).orderID);
expandedRow.setAttribute("asin",asin);
this.appendCollapseButtonOrEmpty(expandedRow,row);
expandedRow.appendChild(this.generateExpandedBox(asin,row));
for(i=0;
i<2;
i++){var detailC=document.createElement("td");
detailC.setAttribute("width","0%");
expandedRow.appendChild(detailC);
}var actionMsgRow=this.generateActionMsgRow(asin,row);
if(row%2==0){expandedRow.className="oddhide rowBodyCollapsed";
collapsedRow.className="oddshow rowHeaderCollapsed";
actionMsgRow.className="even";
}else{expandedRow.className="evenhide rowBodyCollapsed";
collapsedRow.className="evenshow rowHeaderCollapsed";
actionMsgRow.className="odd";
}this.appendChildRows(element,actionMsgRow,collapsedRow,expandedRow);
};
Expand.prototype.getRowId=function(row){return"Row"+row+" expand";
};
Expand.prototype.removeBox=function(row,type){var rowid="Row"+row+" "+type;
var element=parent.document.getElementById("orderListBody");
var rowNum=0;
for(var i=0;
i<element.rows.length;
i++){if(element.rows[i].id==rowid){rowNum=i;
}}if(rowNum!=0){element.deleteRow(rowNum);
}};
Expand.prototype.collapseAll=function(){jQuery("#orderListBody > tr").filter(function(){return this.id.match(/^Row/);
}).each(function(){jQuery(this).remove();
});
};
Expand.prototype.showAutoSearch=function(asin){this.isExpanded=0;
searchFor.isSearch=2;
this.collapseAll();
pageList.empty();
ykl.hideOrderItemsCount();
ykl.showOrderListTable();
var rowid="Row0 expand";
var element=document.getElementById("orderListBody");
this.appendActionMsgRow(element,0,asin);
this.appendCollapseBox(element,0,asin);
var newRow=document.createElement("tr");
newRow.className="evenhide";
newRow.setAttribute("id","Row0 expand");
newRow.setAttribute("oID",itemCache.getDataByASIN(asin).orderID);
newRow.setAttribute("asin",asin);
newRow.appendChild(document.createElement("td"));
newRow.appendChild(this.generateExpandedBox(asin,0));
element.appendChild(newRow);
Subscriptions.addOrderTablePopovers();
this.expand(0,1);
};
Expand.prototype.showSearchList=function(){var startItem=(pageList.currentPage-1)*pageList.pageSize;
if(searchFor.searchResults.length===0){ykl.hideOrderListTable();
}else{for(var count=1;
count<=pageList.pageSize&&startItem<searchFor.searchResults.length;
count++){this.populateSearchRows(searchFor.searchResults[startItem++],count);
}}};
Expand.prototype.generateCollapseButton=function(row){var tdCollapse=document.createElement("td");
tdCollapse.vAlign="top";
tdCollapse.setAttribute("id","Row"+row+"Button");
var inputCollapse=document.createElement("a");
inputCollapse.setAttribute("href","javascript:loadNormalBox("+row+")");
var imageCollapse=document.createElement("img");
imageCollapse.setAttribute("src",collapseButton);
imageCollapse.className="expand";
if(row==0){imageCollapse.setAttribute("onClick","collapseSearch()");
}else{imageCollapse.setAttribute("onClick","loadNormalBox("+row+")");
}inputCollapse.appendChild(imageCollapse);
tdCollapse.appendChild(inputCollapse);
return tdCollapse;
};
Expand.prototype.generateExpandButton=function(row){var tdExpand=document.createElement("td");
tdExpand.setAttribute("id","Row"+row+"Button");
var inputExpand=document.createElement("a");
inputExpand.setAttribute("href","javascript:loadExpandedBox("+row+", 1 )");
var imageExpand=document.createElement("img");
imageExpand.setAttribute("src",expandButton);
imageExpand.className="expand";
inputExpand.appendChild(imageExpand);
tdExpand.appendChild(inputExpand);
return tdExpand;
};
Expand.prototype.enableDelete=function(itemData){};
Expand.prototype.enableDownload=function(itemData){};
Expand.prototype.enableSendWirelessly=function(itemData){};
Expand.prototype.generateActionMsgRow=function(asin,row){var itemData=itemCache.getDataByASIN(asin);
var returnRow=document.createElement("tr");
var returntd=document.createElement("td");
var ieVersion=getInternetExplorerVersion();
if(ieVersion>-1&&ieVersion<8){returntd.setAttribute("colspan",4);
returnRow.appendChild(document.createElement("td"));
}else{returntd.setAttribute("colspan",5);
}returntd.setAttribute("align","left");
var sendSpan=document.createElement("span");
sendSpan.setAttribute("id",this.createStatusSendSingleItemID(itemData));
sendSpan.className="actionMsgSpanSend";
var deleteSpan;
deleteSpan=document.createElement("span");
deleteSpan.className="deleteItemResp";
deleteSpan.setAttribute("id","deleteItemResp_"+itemData.asin);
deleteSpan.className="actionMsgSpanSend";
var genMsgSpan=document.createElement("span");
genMsgSpan.setAttribute("id","genMsgSpan_"+itemData.asin);
genMsgSpan.className="actionMsgSpanSend";
returntd.appendChild(sendSpan);
returntd.appendChild(deleteSpan);
returntd.appendChild(genMsgSpan);
returnRow.appendChild(returntd);
rowid="Row"+row+" actionMsg";
returnRow.setAttribute("id",rowid);
returnRow.setAttribute("row",row);
returnRow.setAttribute("align","left");
returnRow.style.display="none";
return returnRow;
};
Expand.prototype.appendChildRows=function(elem){for(var i=1;
i<arguments.length;
i++){elem.appendChild(arguments[i]);
}};
Expand.prototype.appendCollapseAndLoadingRow=function(elem,newRow,newRow2){elem.appendChild(newRow);
elem.appendChild(newRow2);
};
Expand.prototype.createDeleteContent=function(row,asin,title,author,message){var confirmDelete='<div id="confirmDelete'+row+'"><form name="deleteForm_'+row+'" action="gp/digital/fiona/prototype/download" method="get"><input id="deleteItem_'+asin+'" name="delete" type="hidden"/>'+mykJS.kindle_myk_lib_title+" <b>"+title+"</b><br/>"+mykJS.kindle_myk_lib_author+" <b>"+author+"</b><br/><br/>"+message+'<p/><CENTER><table class="rt"><tr><td class="rt"><input class="ap_custom_close" type="image" src="'+mykJS.btn_yes+'" onclick="javascript:Fion.deleteItem(\'deleteItem_'+asin+"');\"/>"+'</td><td><input class="ap_custom_close" type="image" src="'+mykJS.btn_no+'" /></td></tr></table></CENTER>'+"</form></div>";
return confirmDelete;
};
var wanDevices=new Array("ATVPDKIKX0DER","A3UN6WX5RRO2AG","A1PA6795UKMFR9","A1F83G8C2ARO7P","A13V1IB3VIYZZH","A2EUQ1WTGCTBG2","A3P5ROKL5A1OLE");
Expand.prototype.isWanOnlyDevice=function(device){for(var i=0;
i<wanDevices.length;
++i){if(device.deviceType==wanDevices[i]){return true;
}}return false;
};
Expand.prototype.appendCollapseBox=function(elem,row,asin){var newRow1=this.generateCollapseBox(asin,row);
newRow1.setAttribute("id","Row"+row+" collapse");
elem.appendChild(newRow1);
};
Expand.prototype.appendActionMsgRow=function(elem,row,asin){var actionMsgRow=this.generateActionMsgRow(asin,row);
elem.appendChild(actionMsgRow);
};
Expand.prototype.appendCollapseButtonOrEmpty=function(newRow,row){var td=document.createElement("td");
newRow.appendChild(td);
};
Expand.prototype.createOrderDetail=function(aDetails,detailText,asin,url){if(asin.indexOf("F_S_")==0){var jqDetails=jQuery(aDetails);
jqDetails.attr("href","#subscription");
jqDetails.attr("onclick","javascript:showFeatures(getArrayFeatures("+amznJQ.chars.SQUOTE+"#subscription"+amznJQ.chars.SQUOTE+"))");
return mykJS.kindle_myk_lib_subs_detail;
}aDetails.setAttribute("href",url+"&_ref=kinw_myk_ro_details");
return detailText;
};
Expand.prototype.appendImageElem=function(elem1,row,elem2){if(row!=0){elem1.appendChild(elem2);
}};
Expand.prototype.selectFirstDeviceInOptions=function(isSelected,optionDev){if(!isSelected){optionDev.setAttribute("selected","selected");
isSelected=true;
}return isSelected;
};
Expand.prototype.showLoading=function(row){var table=parent.document.getElementById("orderListBody");
var rowid="Row"+row+"_loading";
var newElement=document.createElement("tr");
newElement.setAttribute("id",rowid);
var tdLoading=document.createElement("td");
tdLoading.setAttribute("colSpan",5);
tdLoading.className="rowLoading";
var img=document.createElement("img");
img.setAttribute("class","loading");
rowid=this.getRowId(row);
var oldelem=parent.document.getElementById(rowid);
if(row%2==0){img.setAttribute("src",loadingGrey);
newElement.className="oddshow";
}else{img.setAttribute("src",loading);
newElement.className="evenshow";
}tdLoading.appendChild(img);
newElement.appendChild(tdLoading);
table.insertBefore(newElement,oldelem);
};
Expand.prototype.createStatusSendSingleItemID=function(itemData){var id=itemData.asin;
if(itemData.asin.indexOf("F_S_")==0){id=itemData.orderID;
}return"singleItemSend_"+id;
};
Expand.prototype.createDeliverContent=function(row,category,asin,itemData,title,author,options,downloadable){var deliver='<div id="deliver_'+row+'"'+'<form action="/gp/digital/fiona/content-download/fiona-dl.html" method="get" name="fionaDL" >'+mykJS.csrfFormArgs+'<input type="hidden" name="type" value="'+category+'" id="type_'+asin+'"/>'+'<input type="hidden" name="contentName" value="'+asin+'" id="fionaHiddenEditionSelect_'+asin+'"/>'+'<table><tr><td><img src="'+itemData.image+'"/></td><td valign="top"><b><div style="text-overflow:ellipsis; overflow:hidden; width:470px; " >'+title+"</div></b><br/>"+author+"</td></tr></table><br/><hr/>"+'<table cellspacing="8"><tr><td><b>'+mykJS.kindle_myk_deliver_to+"&nbsp;</b>"+'<select class="downloadSelect" id="downloadOptionSelect'+row+'" name="deviceID">'+options+"</select></span></td>"+'<td rowspan="2" valign="bottom">';
if(downloadable){deliver+='<div style="color:#666666;font-size:11px;">'+mykJS.kindle_myk_expand_no_wireless_58974+'</div><div><a id="transferLink_'+row+'" href="javascript:void(0)">'+mykJS.kindle_myk_download_title_header+"</a></div>";
}deliver+="</td></tr>"+'<tr><td></td></tr><tr><td><input name="send" class="ap_custom_close" onclick="'+(category=="kindle_pdoc"?"javascript:mykJS.log("+amznJQ.chars.SQUOTE+"pdocs"+amznJQ.chars.SQUOTE+","+amznJQ.chars.SQUOTE+"deliver"+amznJQ.chars.SQUOTE+");":"")+"javascript:selectKindle.dropDownAction("+amznJQ.chars.SQUOTE+"Row"+row+" collapse"+amznJQ.chars.SQUOTE+","+amznJQ.chars.SQUOTE+category+amznJQ.chars.SQUOTE+","+amznJQ.chars.SQUOTE+asin+amznJQ.chars.SQUOTE+","+row+');" type="image" src="'+mykJS.sendButtonImg+'" />&nbsp;'+'<input type="image" src="'+mykJS.cancelButtonImg+'" class="ap_custom_close"/></td></tr></table>'+"</form>"+"</div>";
return deliver;
};
Expand.prototype.collapse=function(row){this.isExpanded=0;
var rowid="Row"+row+" expand";
var element1=parent.document.getElementById(rowid);
rowid="Row"+row+" collapse";
var element2=parent.document.getElementById(rowid);
if(row%2==0){element1.className="oddhide rowBodyCollapsed";
element2.className="oddshow rowHeaderCollapsed";
}else{element1.className="evenhide rowBodyCollapsed";
element2.className="evenshow rowHeaderCollapsed";
}};
var populateIsNeededPopover=function(action,deviceName){jQuery("#isNeededPopover input").unbind();
jQuery("#isNeededPopover input").click(action);
jQuery("#isNeededDeviceName").html(deviceName);
};
var previousPopup;
function showIsNeededPopover(object,deviceName,okAction,closeAction){if(previousPopup){previousPopup.close();
}window.setTimeout(function(){populateIsNeededPopover(okAction,deviceName);
previousPopup=jQuery.AmazonPopover.displayPopover({title:isNeededPopoverTitle,localContent:"#isNeededPopover",closeEventInclude:"CLICK_OUTSIDE",showOnHover:false,width:400,showCloseButton:true,closeText:mykJS.kindle_myk_popover_close_21686,onHide:closeAction?closeAction:"",location:function(popover,settings){var p=object.position();
return{top:p.top,left:p.left-50};
}});
},0);
}function Filter(){this.currentFilter="All";
var allElem=document.getElementById("filter"+this.currentFilter);
}Filter.prototype.filter=function(type,donotUpdateTable){if(type==this.currentFilter&&type.indexOf("_")==-1){return;
}else{this.changeFilter(type);
this.currentFilter=type;
if(type=="All"&&!donotUpdateTable){collapseSearch();
this.showFullList(type);
}else{if(type=="All"&&donotUpdateTable){this.buildFullList();
}else{if(donotUpdateTable){this.buildFilterList(type);
}else{collapseSearch();
this.showFilterList(type);
}}}if(!donotUpdateTable){Subscriptions.addOrderTablePopovers();
}}};
Filter.prototype.showFullList=function(type){var x=1;
var data=0;
itemExpand.collapseAll();
searchFor.isSearch=0;
searchFor.searchResults=[];
var displaySize;
displaySize=ykl.displaySize+1;
while(x<displaySize&&data<itemCache.theData.length){itemExpand.populateRow(itemCache.theData[data++],x++);
}if(itemCache.theData.length){pageList.init();
ykl.showOrderItemsCount();
ykl.toggleStillLoading(type);
}else{ykl.hideOrderListTable(type);
}};
Filter.prototype.buildFullList=function(){searchFor.isSearch=0;
};
Filter.prototype.showFilterList=function(type){this.buildFilterList(type);
var checkIndex=type.indexOf("_");
if(checkIndex!=-1){type=type.substr(0,checkIndex);
}itemExpand.collapseAll();
pageList.init();
if(searchFor.searchResults.length===0){ykl.hideOrderListTable(type);
}else{itemExpand.updateTable();
ykl.toggleStillLoading(type);
}};
Filter.prototype.changeFilter=function(type){if(this.currentFilter!="None"){var elem=document.getElementById("filter"+this.currentFilter);
}searchFor.isSearch=0;
var ID="filter"+type;
var element=document.getElementById(ID);
};
Filter.prototype.none=function(){this.currentFilter="None";
};
Filter.prototype.getCurrentFilter=function(){return jQuery("#filterSearch option:selected").attr("id").substring(6);
};
function Paging(size,retrieved){this.currentPage=1;
this.pages=1;
this.pageSize=size;
this.totalItems=retrieved;
}Paging.prototype.init=function(dontchange){if(!dontchange){this.currentPage=1;
}this.totalItems=0;
if(searchFor.isSearch){this.totalItems=searchFor.searchResults.length;
}else{this.totalItems=itemCache.theData.length;
}this.pages=Math.ceil(this.totalItems/this.pageSize);
if(this.pages==0){this.pages=1;
}this.updateNavBar(this.currentPage);
};
Paging.prototype.empty=function(){this.pages=1;
this.currentPage=1;
this.updateNavBar(this.currentPage);
};
Paging.prototype.gotopage=function(page){this.init(1);
this.updateNavBar(page);
this.currentPage=page;
currentPage=page;
itemExpand.updateTable();
Subscriptions.addOrderTablePopovers();
};
Paging.prototype.updateNavBar=function(page){this.setPrev(page);
this.setNext(page);
this.setDots(page);
var curPage=document.getElementById("curPage");
curPage.innerHTML=page+"&nbsp;";
};
Paging.prototype.setPrev=function(page){var prevPage=document.getElementById("prevPage");
var prevPages=document.getElementById("prevPages");
var firstPage=document.getElementById("firstPage");
if(page==1){prevPage.className="unSelect";
prevPage.innerHTML="&#171; "+mykJS.kindle_myk_your_orders_previous_49301;
firstPage.className="hiddenPage";
}else{prevPage.className="goPage";
prevPage.innerHTML="<a class='myk-link' onclick='mykJS.log(\"ro_page_b\",\"hit\")' href='javascript:pageList.gotopage("+(page-1)+")'>&#171; "+mykJS.kindle_myk_your_orders_previous_49301+"</a>";
firstPage.className="goPage";
}if(page<3){prevPages.className="hiddenPage";
}else{if(page==4){prevPages.className="goPage";
prevPages.innerHTML="<a class='myk-link' onclick='mykJS.log(\"ro_page_b\",\"hit\")' href='javascript:pageList.gotopage("+(page-2)+")'>"+(page-2)+"</a>"+"&nbsp;&nbsp;<a class='myk-link' onclick='mykJS.log(\"ro_page_b\",\"hit\")' href='javascript:pageList.gotopage("+(page-1)+")'>"+(page-1)+"</a>&nbsp;";
}else{prevPages.className="goPage";
prevPages.innerHTML="<a class='myk-link' onclick='mykJS.log(\"ro_page_b\",\"hit\")' href='javascript:pageList.gotopage("+(page-1)+")'>"+(page-1)+"</a>&nbsp;";
}}};
Paging.prototype.setNext=function(page){var nextPage=document.getElementById("nextPage");
var nextPages=document.getElementById("nextPages");
if(this.pages==page){nextPage.className="unSelect";
nextPage.innerHTML=mykJS.kindle_myk_your_orders_next_50197+" &#187;";
}else{nextPage.className="goPage";
nextPage.innerHTML="<a class='myk-link' onclick='mykJS.log(\"ro_page_f\",\"hit\" )' href='javascript:pageList.gotopage("+(page+1)+")'>"+mykJS.kindle_myk_your_orders_next_50197+" &#187;</a>";
}if(page==this.pages){nextPages.className="hiddenPage";
}else{if((page==this.pages-2)||(page==1&&this.pages>2)){nextPages.className="goPage";
nextPages.innerHTML="<a class='myk-link' onclick='mykJS.log(\"ro_page_f\",\"hit\")' href='javascript:pageList.gotopage("+(page+1)+")'>"+(page+1)+"</a>"+"&nbsp;&nbsp;<a class='myk-link' onclick='mykJS.log(\"ro_page_f\",\"hit\")' href='javascript:pageList.gotopage("+(page+2)+")'>"+(page+2)+"</a>&nbsp;";
}else{nextPages.className="goPage";
nextPages.innerHTML="<a class='myk-link' onclick='mykJS.log(\"ro_page_f\",\"hit\")' href='javascript:pageList.gotopage("+(page+1)+")'>"+(page+1)+"</a>";
}}};
Paging.prototype.setDots=function(page){var firstDots=document.getElementById("firstDots");
var lastDots=document.getElementById("lastDots");
if(this.pages>3&&(this.pages-page>2)){lastDots.className="unSelect";
}else{lastDots.className="hiddenPage";
}if(page>4){firstDots.className="unSelect";
}else{firstDots.className="hiddenPage";
}};
function Search(){this.searchResults=[];
this.filterResultObjects=[];
this.isSearch=0;
this.searchParam;
}Search.prototype.lookup=function(searchText,donotUpdateTable){var matchingArray=itemCache.getAllMatches(searchText);
this.isSearch=1;
this.searchResults.length=0;
this.searchParam=searchText;
for(var count=0;
count<matchingArray.length;
count++){this.searchResults[count]=matchingArray[count].asin;
}if(!donotUpdateTable){pageList.init();
itemExpand.updateTable();
Subscriptions.addOrderTablePopovers();
}};
amznJQ.available("jQuery",function(){var $=jQuery,ph=$.pageHooks=new function(){var advance,cur,debug,doc,iframe,options={debug:function(){},iframe:"<iframe id='phie' style='display:none' src='javascript:false;'></iframe>",pollInterval:50},pi,poll;
function extractHash(s){var i=s.indexOf("#");
return(i==-1)?"":s.substring(i+1);
}function getHash(){return extractHash(location.href);
}function setHash(h){debug("set hash",h);
location.hash=h;
}function tr(h){oldHash=cur;
cur=h;
doc.trigger("ph",[oldHash,h]);
}function update(customOptions){debug("update",options,customOptions);
$.extend(options,customOptions);
}function replace(url,full){if(pi){clearTimeout(pi);
pi=undefined;
}if(full){location.href=url;
}else{location.replace(url);
}}this.bind=function(f){$(document).bind("ph",f);
};
this.init=function(customOptions){options=$.extend(options,customOptions);
ch=getHash();
doc=$(document);
debug=options.debug||debug;
debug("init");
var ie=$.browser.msie,dm=document.documentMode;
if(ie&&(dm===undefined||dm<8)){debug("needs iframe");
iframe=$("#phie");
iframe=(iframe.length?iframe:$(options.iframe).prependTo("body"))[0];
advance=function(h,r){debug("advance",h);
try{var i=iframe.contentWindow.document;
i.open();
i.close();
i.location.hash=h;
}catch(e){if(!r){setTimeout(function(){advance(h,200);
},r);
}}};
poll=function(){var h=getHash(),hChange=(cur!=h),ih;
try{ih=extractHash(iframe.contentWindow.document.location.href);
}catch(e){ih=cur;
}if(hChange||cur!=ih){if(hChange){debug("poll",cur,h);
tr(h);
advance(h);
}else{debug("poll-iframe",cur,ih);
tr(ih);
setHash(ih);
}}};
advance(ch);
}else{advance=function(h){debug("advance",h);
if(getHash()!=h){setHash(h);
}};
if("onhashchange" in window){window.onhashchange=function(){var h=getHash();
debug("onhashchange",h);
tr(h);
};
}else{poll=function(){var h=getHash();
if(h!=cur){debug("poll",cur,h);
tr(h);
}};
}}ph.advance=advance;
ph.update=update;
ph.replace=replace;
tr(ch);
if(!pi&&poll){debug("polling");
pi=setInterval(poll,options.pollInterval);
}};
};
amznJQ.declareAvailable("ph");
});
function Sort(){this.currentSort="Date";
this.currentDirection="dsc";
}Sort.prototype.reArrange=function(){var parameter="orderDateNumerical";
if(this.currentSort=="Title"){parameter="titleOrPronunciation";
}else{if(this.currentSort=="Author"){parameter="authorOrPronunciation";
}}var isSortOrderAsc=this.currentDirection=="asc"?this.currentSort=="Date":this.currentSort!="Date";
var ascCompareFunc=function(a,b){var order=0;
a=a[parameter].toString();
b=b[parameter].toString();
if(a>b){order=1;
}else{if(b>a){order=-1;
}}return order;
};
var compareFunc=ascCompareFunc;
if(!isSortOrderAsc){compareFunc=function(a,b){return ascCompareFunc(b,a);
};
}itemCache.theData.sort(compareFunc);
itemExpand.collapseAll();
var x=1;
var data=0;
var displaySize;
displaySize=ykl.displaySize+1;
while(x<displaySize&&data<itemCache.theData.length){itemExpand.populateRow(itemCache.theData[data++],x++);
}};
Sort.prototype.changeDirection=function(){if(this.currentDirection=="dsc"){this.currentDirection="asc";
var element=document.getElementById("sort"+this.currentSort);
element.innerHTML="<span class='mykSprite sortAsc'></span>";
}else{this.currentDirection="dsc";
var element=document.getElementById("sort"+this.currentSort);
element.innerHTML="<span class='mykSprite sortDesc'></span>";
}};
Sort.prototype.changeSort=function(newsort){if(this.currentSort==newsort){this.changeDirection();
}else{this.currentDirection="dsc";
var oldelm=document.getElementById("sort"+this.currentSort);
var oldText=document.getElementById("sort"+this.currentSort+"Text");
var newelm=document.getElementById("sort"+newsort);
var newText=document.getElementById("sort"+newsort+"Text");
oldelm.innerHTML="";
oldText.className="sortOption";
this.currentSort=newsort;
newelm.innerHTML="<span class='mykSprite sortDesc'></span>";
newText.className="sortCurrent";
}this.reArrange();
pageList.init();
pageList.gotopage(1);
ykl.showOrderItemsCount();
this.checkSearch();
Subscriptions.addOrderTablePopovers();
};
Sort.prototype.swap=function(out,inner){var item=itemCache.theData[out];
itemCache.theData[out]=itemCache.theData[inner];
itemCache.theData[inner]=item;
};
Sort.prototype.checkSearch=function(){if(searchFor.isSearch){if(filterList.currentFilter=="None"){searchFor.lookup(searchFor.searchParam);
}else{filterList.showFilterList(filterList.currentFilter);
}}};
function Subscriptions(){}var subsEditions=new Array();
Subscriptions.initSubscriptions=function(table){jQuery(table).find(".manage_selector").each(function(i,ele){var foundBoundDevice=0;
for(var i=0;
i<ele.options.length;
i++){if(ele.getAttribute("boundTo")&&ele.options[i].value==ele.getAttribute("boundTo")){ele.selectedIndex=i;
foundBoundDevice=1;
break;
}}if(!foundBoundDevice){ele.selectedIndex=0;
}jQuery(this).change(function(){var anchor1=this.id.indexOf("_");
var anchor2=this.id.indexOf("_",anchor1+1);
var status=this.id.substring(anchor1+1,anchor2);
var eleIndex=this.id.substring(anchor2+1);
Subscriptions.toggleSaveImg(eleIndex,jQuery(this).attr("boundTo"),status);
}).change();
this.setAttribute("onfocus","mykJS.log('sd_st_dd','cng')");
});
jQuery(table).find(".whatsThis").amazonPopoverTrigger({literalContent:mykJS.whatsThispopup,title:mykJS.kindle_myk_expand_download_transfer_usb_30978,width:500,location:function(popover,settings){return{left:jQuery(window).width()/2-popover.outerWidth()/2,top:jQuery(window).height()/2-popover.outerHeight()/2+jQuery(window).scrollTop()};
},closeEventInclude:"CLICK_OUTSIDE",showCloseButton:true,onShow:function(){mykJS.log("sd_exp_dl_wt","sw");
}});
jQuery(table).find(".whatsThis").show();
getActionPopover(table);
jQuery(table).find(".subsPagination").each(function(i,ele){Subscriptions.addSubsPaginationLink(ele);
});
jQuery(table).find("a.nellOptimized").each(Subscriptions.addOFNPopover);
};
Subscriptions.addOFNPopover=function(){jQuery(this).amazonPopoverTrigger({literalContent:"<div style='font-size:11px'>"+mykJS.nellOptimizedStr+"</div>",showOnHover:true,showCloseButton:false,width:246,openEventInclude:"CLICK_TRIGGER"});
};
Subscriptions.addOrderTablePopovers=function(){jQuery("#orderListBody a.nellOptimized").each(Subscriptions.addOFNPopover);
};
Subscriptions.addActionPopup=function(ele,html,popupTitle){var index=ele.id.indexOf("_");
var num=ele.id.substring(index+1);
var status=ele.id.substring(0,index);
var title=jQuery("#subsTitle"+status+"_"+num).attr("value");
var subID=jQuery("#subs_id_"+status+"_"+num).attr("value");
var amount=jQuery("#subs_amount_"+status+"_"+num).attr("value");
var category=jQuery("#subs_category_"+status+"_"+num).attr("value");
var today=new Date();
amount=amount.replace("$","$ ");
html=html.replace(/{SUB_NAME}/g,title);
html=html.replace(/{SUB_ID}/g,subID);
html=html.replace(/{DATE}/g,today.toLocaleDateString());
html=html.replace(/{INDEX}/g,num);
html=html.replace(/{STATUS}/g,status);
html=html.replace(/{AMOUNT}/g,amount);
var offerChanged=jQuery("#Cancelled_offerChanged_"+num).val();
var planType=jQuery("#Cancelled_planType_"+num).val();
var planID=jQuery("#Cancelled_planID_"+num).val();
var planGroupID=jQuery("#Cancelled_planGroupID_"+num).val();
jQuery("#"+ele.id).amazonPopoverTrigger({literalContent:html,title:popupTitle,width:560,location:"centered",closeText:mykJS.kindle_myk_popover_close_21686,closeEventInclude:"CLICK_OUTSIDE",showCloseButton:true,onShow:function(){jQuery("#reactivateDiv").hide();
jQuery("#reactivateDiv_offerChanged").hide();
jQuery("#reactivateDiv_loading").hide();
if(offerChanged==1){jQuery("#reactivateDiv_loading").show();
var inputData={};
inputData["planType"]=planType;
inputData["planID"]=planID;
inputData["asin"]=planGroupID;
inputData["sid"]=mykJS.sessionId;
ajaxRequest("/gp/digital/fiona/du/subs-check-offer.html",inputData,function(data){jQuery("#reactivateDiv_loading").hide();
if(data.error==1){jQuery("#reactivateDiv_error").show();
}else{if(data.offerChanged==1){jQuery("#reactivateDiv_offerChanged").show();
}else{jQuery("#reactivateDiv").show();
if(category==="fiona_magazine"||category==="fiona_newspaper"){jQuery("#reactivateDiv #privacyWarning").show();
}else{jQuery("#reactivateDiv #privacyWarning").hide();
}}}});
}else{jQuery("#reactivateDiv").show();
if(category==="fiona_magazine"||category==="fiona_newspaper"){jQuery("#reactivateDiv #privacyWarning").show();
}else{jQuery("#reactivateDiv #privacyWarning").hide();
}}}});
};
Subscriptions.toggleSaveImg=function(index,defaultAID,status){var select=jQuery("#fionaHiddenDeviceSelect_"+status+"_"+index)[0];
var img=jQuery("#xfer-img_"+status+"_"+index);
if(defaultAID==null||select.options[select.selectedIndex].value==defaultAID){img.attr("src",mykJS.disabled.src);
img.unbind("click");
img.click(function(){});
}else{img.attr("src",mykJS.enabled.src);
img.unbind("click");
img.click(function(){Subscriptions.updateSubs(index,status);
});
}};
amznJQ.onReady("mykJS",function(){Subscriptions.reactivateSubscription=function(subID,index,status){var inputData={};
var autoRenew=jQuery("#autoRenew"+status+"_"+index).attr("value");
var accountId=jQuery("#fionaAccount"+"_"+status+"_"+index).attr("value");
var deviceSN=jQuery("#device"+"_"+status+"_"+index).attr("value");
var deviceType=jQuery("#deviceType"+"_"+status+"_"+index).attr("value");
var pi=jQuery("#pi"+"_"+status+"_"+index).attr("value");
inputData["id"]=subID;
inputData["action"]="reactivate";
inputData["sid"]=mykJS.sessionId;
inputData["deviceID"]=accountId;
inputData["deviceSN"]=deviceSN;
inputData["deviceType"]=deviceType;
inputData["pi"]=pi;
inputData["useAutoRenew"]=autoRenew;
inputData["t"]=new Date().getTime();
inputData["isAjax"]=1;
var sendingBox=jQuery("#"+status+"StatusMsg");
sendingBox.html('<span class="myk-msg-green">'+mykJS.kindle_myk_popover_sending_60987+"</span>");
sendingBox.show();
mykJS.ajaxRequest("/gp/digital/fiona/du/subscriptions.html",inputData,function(data){Subscriptions.reactivateSubscriptionCallback(data,index,sendingBox);
});
};
Subscriptions.reactivateSubscriptionCallback=function(data,index,sendingBox){if(data.data){sendingBox.html('<span class="myk-msg-green">'+mykJS.kindle_myk_subs_reactivated_reloading_54089+"</span>");
window.setTimeout(function(){window.location.reload();
},1500);
}else{sendingBox.text(mykJS.subsFailureStr);
window.setTimeout(function(){sendingBox.hide();
},1500);
}};
});
Subscriptions.cancelSubscriptionCallback=function(data,index,sendingBox,status){if(data.data){sendingBox.html('<span class="myk-msg-green">'+mykJS.kindle_myk_subs_cancelled_reloading_50978+"</span>");
window.setTimeout(function(){window.location.reload();
},1500);
}else{sendingBox.html('<span class="myk-msg-red">'+mykJS.subsFailureStr+"</span>");
window.setTimeout(function(){hideSubsActionMsgRow(sendingBox);
sendingBox.hide();
},1500);
}};
Subscriptions.cancelSubscription=function(subID,index,status){var inputData={};
inputData["id"]=subID;
inputData["action"]="cancel";
inputData["sid"]=mykJS.sessionId;
inputData["t"]=new Date().getTime();
inputData["isAjax"]=1;
var sendingBox=jQuery("#"+status+"StatusMsg");
var lib=jQuery("#lib_"+status+"_"+index);
if(lib&&lib.attr("value")=="library"){sendingBox=jQuery("#singleItemSend_"+subID);
}sendingBox.html('<span class="myk-msg-green">'+mykJS.kindle_myk_popover_sending_60987+"</span>");
showSubsActionMsgRow(sendingBox);
sendingBox.show();
var optionsChecked=new Array();
jQuery(".feedbackOnCancelSubChkBox:checked").each(function(i,ele){optionsChecked.push(ele.value);
});
var optionsCheckedString=optionsChecked.join(",");
var feedbackText=jQuery("#feedbackOnCancelSubTextArea").val();
var feedbackData={};
feedbackData["sessionID"]=mykJS.sessionId;
feedbackData["sourceID"]="SUBSCRIPTION_CANCELLATION";
feedbackData["issueTypeIDs"]=optionsCheckedString;
feedbackData["issueText"]=feedbackText;
feedbackData["subscriptionID"]=subID;
mykJS.ajaxRequest("/gp/digital/fiona/du/feedback.html",feedbackData);
mykJS.ajaxRequest("/gp/digital/fiona/du/subscriptions.html/ref=kinw_myk_sd_cl",inputData,function(data){Subscriptions.cancelSubscriptionCallback(data,index,sendingBox,status);
});
};
Subscriptions.sendSingleItem=function(index,status){if(Subscriptions.validateAccountId(index,status)==false){return;
}var kindleName=jQuery("#fionaHiddenDevice_"+status+"_"+index+" option:selected").text();
var sendingBox=jQuery("#singleItemSend_"+status+"_"+index);
var id=jQuery("#subs_id_"+status+"_"+index).attr("value");
var lib=jQuery("#lib_"+status+"_"+index);
if(lib&&lib.attr("value")=="library"){sendingBox=jQuery("#singleItemSend_"+id);
}sendingBox.text(mykJS.kindle_myk_popover_sending_60987);
showSubsActionMsgRow(sendingBox);
sendingBox.show();
var fionaAccountId=jQuery("#fionaHiddenDevice_"+status+"_"+index).attr("value");
var editionSelect=jQuery("#fionaEditionSelect_"+status+"_"+index)[0];
var edition=editionSelect.options[editionSelect.selectedIndex].value;
var category=jQuery("#subs_category_"+status+"_"+index).val();
var isSizeGreaterThan50Mb=subsEditions[edition];
var inputData={};
inputData["deviceID"]=fionaAccountId;
inputData["contentName"]=edition;
inputData["category"]=category;
inputData["id"]=id;
inputData["t"]=new Date().getTime();
inputData["isAjax"]=1;
mykJS.ajaxRequest("/gp/digital/fiona/content-download/fiona-ajax.html/ref=kinw_myk_sd_exp_send",inputData,function(data){Subscriptions.sendSingleItemCallback(data,sendingBox,kindleName,isSizeGreaterThan50Mb);
});
};
Subscriptions.sendSingleItemCallback=function(data,sendingBox,kindleName,isSizeGreaterThan50Mb){if(data.data){if(isSizeGreaterThan50Mb){sendingBox.html('<span class="myk-msg-red">'+mykJS.kindle_myk_subs_sent_success_for_greater_50mb+"</span>");
}else{sendingBox.text(mykJS.kindle_myk_subs_sent_success_6929+" "+kindleName);
}}else{if(data.error){sendingBox.html('<span class="myk-msg-red">'+data.error+"</span>");
}}window.setTimeout(function(){sendingBox.hide();
hideSubsActionMsgRow(sendingBox);
},mykJS.fadeOut);
};
Subscriptions.updateDevices=function(index,status){var values=new Array();
jQuery("input[name=device_"+status+"_"+index+"]:checked").each(function(){values.push(jQuery(this).val());
});
var subID=jQuery("#subs_id_"+status+"_"+index).attr("value");
var sid=jQuery("#subs_sid_"+index).attr("value");
var inputData={};
inputData["id"]=subID;
inputData["sid"]=sid;
inputData["action"]="xfer";
inputData["t"]=new Date().getTime();
inputData["deviceID"]=values;
inputData["isAjax"]=1;
var sendingBox=jQuery("#"+status+"StatusMsg");
sendingBox.html('<span class="myk-msg-green">'+mykJS.kindle_myk_popover_sending_60987+"</span>");
sendingBox.show();
mykJS.ajaxRequest("/gp/digital/fiona/du/subscriptions.html/ref=kinw_myk_sd_st_saved",inputData,function(data){Subscriptions.updateSubsCallback(data,index,status,sendingBox,values);
});
};
Subscriptions.updateSubs=function(index,status){var select=jQuery("#fionaHiddenDeviceSelect_"+status+"_"+index)[0];
var fionaAccountId=select.options[select.selectedIndex].value;
var subID=jQuery("#subs_id_"+status+"_"+index).attr("value");
var sid=jQuery("#subs_sid_"+index).attr("value");
var inputData={};
inputData["id"]=subID;
inputData["deviceID"]=fionaAccountId;
inputData["sid"]=sid;
inputData["action"]="xfer";
inputData["t"]=new Date().getTime();
inputData["isAjax"]=1;
var sendingBox=jQuery("#"+status+"StatusMsg");
sendingBox.html('<span class="myk-msg-green">'+mykJS.kindle_myk_popover_sending_60987+"</span>");
sendingBox.show();
Subscriptions.toggleSaveImg(index,null,1);
mykJS.ajaxRequest("/gp/digital/fiona/du/subscriptions.html/ref=kinw_myk_sd_st_saved",inputData,function(data){Subscriptions.updateSubsCallback(data,index,status,sendingBox,fionaAccountId);
});
};
Subscriptions.updateSubsCallback=function(data,index,status,sendingBox,fionaAccountId){if(data.data){sendingBox.html('<span class="myk-msg-green">'+mykJS.transferSuccessStr+"</span>");
jQuery("#fionaHiddenDeviceSelect_"+status+"_"+index).attr("boundTo",fionaAccountId);
jQuery("#fionaHiddenDevice_"+status+"_"+index).attr("value",fionaAccountId);
window.setTimeout(function(){window.location.reload();
},1500);
}else{sendingBox.html('<span class="myk-msg-red">'+mykJS.subsFailureStr+"</span>");
}jQuery("#fionaHiddenDeviceSelect_"+status+"_"+index).change();
window.setTimeout(function(){sendingBox.hide();
},1500);
};
Subscriptions.addSubsPaginationLink=function(ele){jQuery(ele).unbind("click");
jQuery(ele).click(function(){var inputData={};
inputData.sid=jQuery("#subs_sid_0").attr("value");
inputData.status=jQuery(this).attr("status");
inputData.offset=jQuery(this).attr("href").substr(jQuery(this).attr("href").indexOf("offset=")+7);
inputData.t=new Date().getTime();
var subsTable=jQuery("#subsContent_"+inputData.status+" .subsTable");
subsTable.before(jQuery("<div/>").css({"height":subsTable.height(),"width":subsTable.width(),"position":"absolute","background-color":"white","opacity":0.6}));
subsTable.before(jQuery("<div>"+mykJS.kindle_myk_loading_text+"</div>").css({"position":"absolute","height":subsTable.height()/2,"width":subsTable.width(),"margin-top":subsTable.height()/2,"text-align":"center","font-weight":"bold"}));
jQuery.get("/gp/digital/fiona/du/subscriptionsPage.html",inputData,function(data){jQuery("#subsContent_"+inputData.status).replaceWith(data);
Subscriptions.initSubscriptions(jQuery("#subsContent_"+inputData.status));
});
return false;
});
};
Subscriptions.toggleRow=function(index,status){jQuery("#row"+status+index).toggle();
jQuery("#imgrow"+status+index).toggle();
var col=jQuery("#spanrow"+status+index);
var img=jQuery("#togglerow"+status+index);
if(img.attr("src")==mykJS.expandButtonImg){img.attr("src",mykJS.collapseButtonImg);
if(status=="Active"&&jQuery("#row_Editions_"+status+"_"+index).css("display")=="none"){Subscriptions.getEdition("",index,status);
}}else{mykJS.log("sd_col","hit");
img.attr("src",mykJS.expandButtonImg);
}};
Subscriptions.getEdition=function(prefix,index,status){mykJS.log("sd_exp","hit");
jQuery("#row_Editions_Loading_"+status+"_"+prefix+index).show();
var asin=jQuery("#subs_asin_"+status+"_"+index).val();
var inputData={};
inputData["asin"]=asin;
inputData["sid"]=mykJS.sessionId;
this.requestEdition(inputData,prefix,index,status);
};
Subscriptions.getEditionsInCloud=function(prefix,index,status,pubFrequency,category){mykJS.log("sd_exp","hit");
jQuery("#row_Editions_Loading_"+status+"_"+prefix+index).show();
var asin=jQuery("#subs_asin_"+status+"_"+index).val();
var inputData={};
inputData["asin"]=asin;
inputData["sid"]=mykJS.sessionId;
this.requestEditionsInCloud(inputData,prefix,index,status,pubFrequency,category);
};
Subscriptions.requestEdition=function(inputData,prefix,index,status){var asin=inputData["asin"];
inputData["isAjax"]=1;
if(subsEditions[asin]){Subscriptions.populateEditions(prefix+index,status,subsEditions[asin],asin);
}else{ajaxRequest("/gp/digital/fiona/du/pastEditions.html",inputData,function(data){Subscriptions.populateEditions(prefix+index,status,data,asin);
});
}};
Subscriptions.requestEditionsInCloud=function(inputData,prefix,index,status,pubFrequency,category,update){var asin=inputData["asin"];
var year=inputData["year"];
var month=inputData["month"];
inputData["isAjax"]=1;
inputData["category"]=category;
inputData["pubFrequency"]=pubFrequency;
if(!update&&subsEditions[asin]){if(category=="fiona_magazine"){Subscriptions.populateMagazineEditionsInCloud(prefix+index,status,subsEditions[asin],asin);
}else{Subscriptions.populateNewspaperEditionsInCloud(prefix+index,status,subsEditions[asin],asin);
}}else{ajaxRequest("/gp/digital/fiona/du/pastEditionsInCloud.html",inputData,function(data){if(category=="fiona_magazine"){Subscriptions.populateMagazineEditionsInCloud(prefix+index,status,data,asin,year);
}else{Subscriptions.populateNewspaperEditionsInCloud(prefix+index,status,data,asin,year,month);
}});
}};
Subscriptions.validateAccountId=function(index,status){var fionaAccountId=jQuery("#fionaHiddenDevice_"+status+"_"+index).attr("value");
if(!fionaAccountId||fionaAccountId=="accountID"){alert(mykJS.kindle_myk_subs_assoc_valid_device_31290);
return false;
}return true;
};
Subscriptions.activateSubs=function activateSubs(accountId,encMarketplaceId){var inputVars={};
inputVars["sid"]=mykJS.sessionId;
inputVars["accountId"]=accountId;
inputVars["encMarketplaceId"]=encMarketplaceId;
inputVars["ajax"]=1;
jQuery("#CreationPendingStatusMsg").html('<span class="myk-msg-green">'+mykJS.kindle_myk_popover_sending_60987+"</span>");
mykJS.ajaxRequest("/gp/digital/fiona/du/activate-subs.html",inputVars,function(data){if(data.error){jQuery("#CreationPendingStatusMsg").html('<span class="myk-msg-red">'+mykJS.subsFailureStr+"</span>");
window.setTimeout(function(){jQuery("#CreationPendingStatusMsg").text();
},2500);
}else{jQuery("#CreationPendingStatusMsg").html('<span class="myk-msg-green">'+mykJS.kindle_myk_subs_activated_reloading_26943+"</span>");
window.setTimeout(function(){window.location.reload();
},2500);
}});
return false;
};
Subscriptions.populateEditions=function(index,status,data,asin){if(data.data){subsEditions[asin]=data;
var select=jQuery("#fionaEditionSelect_"+status+"_"+index);
var editions=data.data;
for(var i=0;
i<editions.length;
i++){var edition=editions[i];
var option="<option value='F_E_"+edition["editionAsin"]+"_"+asin+"'>"+edition["editionTime"]+"</option>";
select.append(option);
if(edition["isSizeGreaterThan50Mb"]){subsEditions["F_E_"+edition["editionAsin"]+"_"+asin]="sizeGreaterThan50Mb";
}}}else{if(data.error){var div=jQuery("#row_Editions_"+status+"_"+index);
div.css("color","red");
div.html(data.error);
}}jQuery("#row_Editions_Loading_"+status+"_"+index).hide();
jQuery("#row_Editions_"+status+"_"+index).show();
};
Subscriptions.populateNewspaperEditionsInCloud=function(index,status,data,asin,updateFromYear,updateFromMonth){if(data.data){var allEditions;
var dateInput=jQuery("#fionaEditionDate_"+status+"_"+index);
var inputElement=jQuery("#fionaEditionContentName_"+status+"_"+index);
var submitButton=jQuery("#fionaEditionSubmit_"+status+"_"+index);
var pubFrequency=data.data.pubFrequency;
if(updateFromYear){var editions=data.data.editions;
for(var year in editions){for(var month in editions[year]){subsEditions[asin].data.editions[year][month]=editions[year][month];
}}allEditions=subsEditions[asin].data.editions;
jQuery("#row_Editions_Loading_"+status+"_"+index).hide();
jQuery("#row_Editions_"+status+"_"+index).show();
var goToDate=new Date(updateFromMonth+"/31/"+updateFromYear);
dateInput.kicsCalendar("show");
dateInput.kicsCalendar("goToDate",goToDate);
}else{subsEditions[asin]=data;
allEditions=subsEditions[asin].data.editions;
var endDate=new Date(data.data.endDate);
var startDate=new Date(data.data.startDate);
submitButton.attr("disabled",true).css("opacity",0.4);
var validateDate=function(date){if(allEditions.hasOwnProperty(date.getFullYear())&&allEditions[date.getFullYear()].hasOwnProperty(date.getMonth()+1)&&allEditions[date.getFullYear()][date.getMonth()+1].hasOwnProperty(date.getDate())){return 1;
}else{return 0;
}};
dateInput.bind("kicsCalendarDatePrev",function(e,date){if(!allEditions.hasOwnProperty(date.getFullYear())||!allEditions[date.getFullYear()].hasOwnProperty(date.getMonth()+1)){jQuery("#row_Editions_"+status+"_"+index).hide();
dateInput.kicsCalendar("hide");
jQuery("#row_Editions_Loading_"+status+"_"+index).show();
var inputData={};
inputData["asin"]=asin;
inputData["sid"]=mykJS.sessionId;
inputData["year"]=date.getFullYear();
inputData["month"]=date.getMonth()+1;
Subscriptions.requestEditionsInCloud(inputData,"",index,status,pubFrequency,"fiona_newspaper",1);
}});
dateInput.bind("kicsCalendarDateOver",function(e,td,date){if(validateDate(date)){return;
}var td=jQuery(td);
var tooltip=jQuery('<p class="calendarTooltip" />');
td.parents(".kicsCalendar").append(tooltip);
tooltip.text(mykJS.noEditionAvailableMsg);
tooltip.css({top:td.position().top-tooltip.outerHeight()-5,left:td.position().left+(td.outerWidth()/2)-(tooltip.outerWidth()/2)});
});
dateInput.bind("kicsCalendarDateOut",function(e,td,date){jQuery(td).parents(".kicsCalendar").find(".calendarTooltip").remove();
});
dateInput.bind("kicsCalendarHide",function(e,calendar){jQuery(calendar).find(".calendarTooltip").remove();
});
dateInput.bind("change",function(){var value=dateInput.val();
var date=new Date(value);
if(kicsDate.isValid(date)&&validateDate(date)){var edition=allEditions[date.getFullYear()][date.getMonth()+1][date.getDate()];
if(edition["isSizeGreaterThan50Mb"]){subsEditions["F_E_"+edition["editionAsin"]+"_"+asin]="sizeGreaterThan50Mb";
}inputElement.val("F_E_"+edition["editionAsin"]);
submitButton.removeAttr("disabled").css("opacity",1);
var formattedDate=kicsDate.format(date,"mm/dd/yyyy");
if(value!=formattedDate){dateInput.val(formattedDate);
}}else{submitButton.attr("disabled",true).css("opacity",0.4);
}});
dateInput.kicsCalendar({"id":"fionaEditionCalender_"+status+"_"+index,"monthNames":mykJS.monthMap,"dayNames":mykJS.dayMap,"prev":"<img src='"+mykJS.previousArrow+"'/>","next":"<img src='"+mykJS.nextArrow+"'/>","dateFormat":"mm/dd/yyyy","minDate":startDate,"maxDate":endDate,"defaultDate":endDate,"date":endDate,"isDateValid":validateDate,});
var buttonHtml="<img class='calenderButton' id='fionaEditionCalenderButton_"+status+"_"+index+"' src='"+mykJS.calenderButton+"'/>";
var button=jQuery(buttonHtml);
dateInput.after(button);
button.unbind("mousedown");
button.bind("mousedown",function(){dateInput.kicsCalendar("ignoreEvent");
dateInput.kicsCalendar("toggle");
});
jQuery("#fionaEditionCalender_"+status+"_"+index).bind("click",function(e){e.stopPropagation();
});
jQuery("#row_Editions_Loading_"+status+"_"+index).hide();
jQuery("#row_Editions_"+status+"_"+index).show();
}}else{if(data.error){var div=jQuery("#row_Editions_"+status+"_"+index);
div.css("color","red");
div.html(data.error);
jQuery("#row_Editions_Loading_"+status+"_"+index).hide();
jQuery("#row_Editions_"+status+"_"+index).show();
}}};
Subscriptions.populateMagazineEditionsInCloud=function(index,status,data,asin,updateFromYear){if(data.data){data.data.endDate=new Date(data.data.endDate);
data.data.startDate=new Date(data.data.startDate);
var shovellerId="editionShoveller_"+status+"_"+index;
var shoveller;
if(updateFromYear){var editions=data.data.editions;
for(var key in editions){subsEditions[asin].data.editions[key]=data.data.editions[key];
}shoveller=EditionShovellers.handlers[shovellerId];
shoveller.loadNewEditions(updateFromYear);
}else{subsEditions[asin]=data;
shoveller=new EditionShoveller(shovellerId,asin,status,index,data.data);
shoveller.initializeDropdown();
shoveller.loadNewEditions();
var submitButton=jQuery("#fionaEditionSubmit_"+status+"_"+index);
submitButton.attr("disabled",true).css("opacity",0.4);
}shoveller.onLoadScroll();
}else{if(data.error){var div=jQuery("#row_Editions_"+status+"_"+index);
div.css("color","red");
div.html(data.error);
}}jQuery("#row_Editions_Loading_"+status+"_"+index).hide();
jQuery("#row_Editions_"+status+"_"+index).show();
};
var deliverFutureEditionPopover;
function displayEditDeliverFutureEditionPopover(ele){if(deliverFutureEditionPopover){deliverFutureEditionPopover.close();
}var index1=ele.id.indexOf("_");
var index2=ele.id.indexOf("_",index1+1);
var status=ele.id.substring(index1+1,index2);
var index=ele.id.substring(index2+1);
var html=jQuery("#deliverHTML_"+status+"_"+index).html();
var object=jQuery(ele);
window.setTimeout(function(){deliverFutureEditionPopover=jQuery.AmazonPopover.displayPopover({literalContent:html,openEventInclude:"CLICK_TRIGGER",closeEventInclude:"CLICK_OUTSIDE",showCloseButton:true,closeText:mykJS.kindle_myk_popover_close_21686,title:mykJS.kindle_myk_deliver_future_header,group:"privacySetting",location:function(popover,settings){var p=object.offset();
return{top:p.top+5,left:p.left-150};
},width:400,onShow:function(){Subscriptions.onSubmitDeliverFutureEditionPopover(status,index);
}});
},0);
}function createDownloadPastIssuePopover(title,status,row,devices,img,subsId,asin,inputData){var downloadIssue=mykJS.downloadPastIssue;
downloadIssue=downloadIssue.replace(/{SUB_NAME}/g,title);
downloadIssue=downloadIssue.replace(/{STATUS}/g,status);
downloadIssue=downloadIssue.replace(/{ROW}/g,row);
downloadIssue=downloadIssue.replace(/{DEVICES}/g,devices);
downloadIssue=downloadIssue.replace(/{IMGSRC}/g,img);
downloadIssue=downloadIssue.replace(/{SUB_ID}/g,subsId);
jQuery("#download_"+asin).amazonPopoverTrigger({literalContent:downloadIssue,openEventInclude:"CLICK_TRIGGER",title:mykJS.kindle_myk_download_title_header,width:600,location:["over"],closeEventInclude:"CLICK_OUTSIDE",onShow:function(){if(!devices){jQuery("#row_Editions_Loading_"+status+"_d"+row).hide();
jQuery("#row_Editions_"+status+"_d"+row).css("color","red").html(mykJS.blogs_no_targeting_device_error_msg).show();
}else{if(inputData!=""){Subscriptions.requestEdition(inputData,"d",row,status);
}else{Subscriptions.getEdition("d",row,status);
}}}});
}function createDownloadPastIssuesInCloudPopover(title,status,row,devices,img,subsId,asin,inputData,category,pubFrequency){var downloadIssue,popupWidth;
if(category=="fiona_magazine"){downloadIssue=mykJS.downloadMagazinePastIssuesInCloud;
popupWidth=813;
}else{downloadIssue=mykJS.downloadNewspaperPastIssuesInCloud;
popupWidth=600;
}downloadIssue=downloadIssue.replace(/{SUB_NAME}/g,title);
downloadIssue=downloadIssue.replace(/{STATUS}/g,status);
downloadIssue=downloadIssue.replace(/{ROW}/g,row);
downloadIssue=downloadIssue.replace(/{DEVICES}/g,devices);
downloadIssue=downloadIssue.replace(/{IMGSRC}/g,img);
downloadIssue=downloadIssue.replace(/{SUB_ID}/g,subsId);
jQuery("#download_"+asin).amazonPopoverTrigger({literalContent:downloadIssue,openEventInclude:"CLICK_TRIGGER",title:mykJS.kindle_myk_download_title_header,width:popupWidth,location:["over"],closeEventInclude:"CLICK_OUTSIDE",onHide:function(){if(category=="fiona_newspaper"){jQuery("#fionaEditionDate_"+status+"_d"+row).unbind();
jQuery(document).unbind("mouseup");
jQuery("#fionaEditionCalender_"+status+"_d"+row).remove();
}},onShow:function(){if(category=="fiona_magazine"&&(pubFrequency=="Weekly"||pubFrequency=="Bi-weekly"||pubFrequency=="Daily")){jQuery("#editionMonthSelect_"+status+"_"+row).show();
}if(!devices){jQuery("#row_Editions_Loading_"+status+"_d"+row).hide();
jQuery("#row_Editions_"+status+"_d"+row).css("color","red").html(mykJS.blogs_no_targeting_device_error_msg).show();
}else{if(inputData!=""){Subscriptions.requestEditionsInCloud(inputData,"d",row,status,pubFrequency,category);
}else{Subscriptions.getEditionsInCloud("d",row,status,pubFrequency,category);
}}}});
}function createDeliverPastIssuePopover(transferLink,title,status,row,devices,img,subsId,asin,inputData,value,category){var deliverIssue=mykJS.deliverPastIssue;
deliverIssue=deliverIssue.replace(/{TRANSFER_VIA_USB_LINK}/,transferLink);
deliverIssue=deliverIssue.replace(/{SUB_NAME}/g,title);
deliverIssue=deliverIssue.replace(/{STATUS}/g,status);
deliverIssue=deliverIssue.replace(/{ROW}/g,row);
deliverIssue=deliverIssue.replace(/{DEVICES}/g,devices);
deliverIssue=deliverIssue.replace(/{IMGSRC}/g,img);
deliverIssue=deliverIssue.replace(/{SUB_ID}/g,subsId);
deliverIssue=deliverIssue.replace(/{ASIN}/g,asin);
deliverIssue=deliverIssue.replace(/{CATEGORY}/g,category);
deliverIssue=deliverIssue.replace(/{LIBVALUE}/g,value);
jQuery("#deliver_"+asin).amazonPopoverTrigger({literalContent:deliverIssue,openEventInclude:"CLICK_TRIGGER",title:mykJS.kindle_myk_deliver_past_issue_header,width:550,location:["over"],closeEventInclude:"CLICK_OUTSIDE",onShow:function(){if(!devices){jQuery("#row_Editions_Loading_"+status+"_"+row).hide();
jQuery("#row_Editions_"+status+"_"+row).css("color","red").html(mykJS.blogs_no_targeting_device_error_msg).show();
}else{if(inputData!=""){Subscriptions.requestEdition(inputData,"",row,status);
}else{Subscriptions.getEdition("",row,status);
}}}});
}function createDeliverPastIssuesInCloudPopover(transferLink,title,status,row,devices,img,subsId,asin,inputData,value,category,pubFrequency){var deliverIssue,popupWidth;
if(category=="fiona_magazine"){popupWidth=813;
deliverIssue=mykJS.deliverMagazinePastIssuesInCloud;
}else{popupWidth=550;
deliverIssue=mykJS.deliverNewspaperPastIssuesInCloud;
}deliverIssue=deliverIssue.replace(/{TRANSFER_VIA_USB_LINK}/,transferLink);
deliverIssue=deliverIssue.replace(/{SUB_NAME}/g,title);
deliverIssue=deliverIssue.replace(/{STATUS}/g,status);
deliverIssue=deliverIssue.replace(/{ROW}/g,row);
deliverIssue=deliverIssue.replace(/{DEVICES}/g,devices);
deliverIssue=deliverIssue.replace(/{IMGSRC}/g,img);
deliverIssue=deliverIssue.replace(/{SUB_ID}/g,subsId);
deliverIssue=deliverIssue.replace(/{ASIN}/g,asin);
deliverIssue=deliverIssue.replace(/{CATEGORY}/g,category);
deliverIssue=deliverIssue.replace(/{LIBVALUE}/g,value);
jQuery("#deliver_"+asin).amazonPopoverTrigger({literalContent:deliverIssue,openEventInclude:"CLICK_TRIGGER",title:mykJS.kindle_myk_deliver_past_issue_header,width:popupWidth,location:["over"],closeEventInclude:"CLICK_OUTSIDE",onHide:function(){if(category=="fiona_newspaper"){jQuery("#fionaEditionDate_"+status+"_"+row).unbind();
jQuery(document).unbind("mouseup");
jQuery("#fionaEditionCalender_"+status+"_"+row).remove();
}},onShow:function(){if(category=="fiona_magazine"&&(pubFrequency=="Weekly"||pubFrequency=="Bi-weekly"||pubFrequency=="Daily")){jQuery("#editionMonthSelect_"+status+"_"+row).show();
}if(!devices){jQuery("#row_Editions_Loading_"+status+"_"+row).hide();
jQuery("#row_Editions_"+status+"_"+row).css("color","red").html(mykJS.blogs_no_targeting_device_error_msg).show();
}else{if(inputData!=""){Subscriptions.requestEditionsInCloud(inputData,"",row,status,pubFrequency,category);
}else{Subscriptions.getEditionsInCloud("",row,status,pubFrequency,category);
}}}});
}function showSubsActionMsgRow(sendingBox){sendingBox.parents("tr:first").css("display","table-row");
}function hideSubsActionMsgRow(sendingBox){sendingBox.parents("tr:first").hide();
}var EditionShovellers={};
EditionShovellers.handlers=[];
EditionShovellers.selectEdition=function(id,asin,shovellerId){var controller=EditionShovellers.handlers[shovellerId];
controller.selectEdition(id,asin);
};
function EditionShoveller(id,asin,status,index,data){EditionShovellers.handlers[id]=this;
this.data=data;
this.status=status;
this.index=index;
this.allEditions=subsEditions[asin].data.editions;
this.shovellerId="editionShoveller_"+status+"_"+index;
this.shoveller=jQuery("#"+this.shovellerId);
this.shovellerContainer=jQuery("#editionShovellerContainer_"+status+"_"+index);
this.yearSelect=jQuery("#editionYearSelect_"+status+"_"+index);
this.monthSelect=jQuery("#editionMonthSelect_"+status+"_"+index);
this.inputElement=jQuery("#fionaEditionContentName_"+status+"_"+index);
this.submitButton=jQuery("#fionaEditionSubmit_"+status+"_"+index);
this.shovellerEditions=[];
this.loadStatus=[];
this.nextYearToBeLoaded;
this.scrollToPage;
this.editionsPerPage=5;
this.selectedCell;
this.subsAsin=asin;
this.STEP=20;
this.SPEED=1;
}EditionShoveller.prototype.selectEdition=function(id,asin){var cell=jQuery("#"+id);
cell.removeClass("shovellerCellUnselect").addClass("shovellerCellSelect");
this.inputElement.val("F_E_"+asin);
this.submitButton.removeAttr("disabled").css("opacity",1);
if(this.selectedCell&&this.selectedCell.attr("id")!=cell.attr("id")){this.selectedCell.removeClass("shovellerCellSelect").addClass("shovellerCellUnselect");
}this.selectedCell=cell;
};
EditionShoveller.prototype.flickStep=function(id,destScrollVal,scrollDir,callback){var container=jQuery("#"+id);
var scrollFunc;
var maxScroll;
if(scrollDir=="v"){scrollFunc=container.scrollTop;
maxScroll=container.attr("scrollHeight");
}else{scrollFunc=container.scrollLeft;
maxScroll=container.attr("scrollWidth");
}if((destScrollVal+container.width())>maxScroll||destScrollVal<0||isNaN(destScrollVal)){return;
}var currScrollVal=scrollFunc.call(container);
var step;
if(destScrollVal>=currScrollVal){step=Math.min(destScrollVal-currScrollVal,this.STEP);
}else{step=Math.max(destScrollVal-currScrollVal,-this.STEP);
}var controller=this;
if(step==0||isNaN(step)){if(callback){callback.call(controller);
}return;
}var nextScrollVal=currScrollVal+step;
scrollFunc.call(container,nextScrollVal);
setTimeout(function(){controller.flickStep(id,destScrollVal,scrollDir,callback);
},controller.SPEED);
};
EditionShoveller.prototype.initializeDropdown=function(){var options="";
for(var i=this.data.endDate.getFullYear();
i>=this.data.startDate.getFullYear();
i--){options+="<option value='"+i+"'>"+i+"</option>";
}var controller=this;
this.yearSelect.change(function(){controller.loadNewEditions();
}).append(options);
frequency=this.data.frequency;
if(frequency=="Weekly"||frequency=="Bi-weekly"||frequency=="Daily"){var options="";
for(var i=1;
i<=12;
i++){options+="<option id ='monthSelect_"+i+"' value='"+i+"'>"+mykJS.monthMap[i-1]+"</option>";
}this.monthSelect.show().attr("disabled",true).css("opacity",0.4).change(function(){controller.loadNewEditions();
}).append(options);
}};
EditionShoveller.prototype.getEditionsHTML=function(editions,fromIndex,toIndex){var shovellerCellsHtml="";
if(this.loadStatus[fromIndex]==1){return shovellerCellsHtml;
}if(!toIndex){toIndex=fromIndex+this.editionsPerPage;
}for(var i=fromIndex;
i<editions.length&&i<toIndex;
i++){var edition=editions[i];
if(edition["isSizeGreaterThan50Mb"]){subsEditions["F_E_"+edition["editionAsin"]+"_"+this.subsAsin]="sizeGreaterThan50Mb";
}var cellClass=(i+1)%this.editionsPerPage?"editionShovellerCell":"editionShovellerLastCell";
var cellId="editionShovellerCell_"+this.status+"_"+this.index+"_"+i;
var cell="<div id='"+cellId+"' "+"class='"+cellClass+"' "+"onclick=EditionShovellers.selectEdition('"+cellId+"','"+edition["editionAsin"]+"','"+this.shovellerId+"') >";
cell+="<img class='editionShovellerCellImg' src="+edition["editionImg"]+">";
cell+="<div class='editionShovellerImgText'>"+edition["editionPublishedDate"]+"</div>";
cell+="</div>";
shovellerCellsHtml+=cell;
this.loadStatus[i]=1;
}return shovellerCellsHtml;
};
EditionShoveller.prototype.navigationClicked=function(scrollDir,shovellerEditions){jQuery("#previous").unbind("click");
jQuery("#next").unbind("click");
var currScrollVal=this.shoveller.scrollLeft.call(this.shoveller);
var destScrollVal=currScrollVal+scrollDir*this.shoveller.width();
var maxScrollWidth=this.shoveller.attr("scrollWidth");
if((this.shovellerEditions.length%this.editionsPerPage&&destScrollVal+this.shoveller.width()==maxScrollWidth)||destScrollVal==maxScrollWidth){var selectedYear=this.yearSelect.find(":selected").val();
var selectedMonth=this.monthSelect.find(":selected").val();
if(!selectedMonth&&!selectedYear&&this.nextYearToBeLoaded&&this.nextYearToBeLoaded>=this.data.startDate.getFullYear()){this.getNewEditions(this.nextYearToBeLoaded);
return;
}}this.shovellerContainer.append(this.getEditionsHTML(this.shovellerEditions,this.editionsPerPage*destScrollVal/this.shoveller.width()));
this.flickStep(this.shovellerId,destScrollVal,"h",this.updateNavigationButtons);
};
EditionShoveller.prototype.updateNavigationButtons=function(){var selectedYear=this.yearSelect.find(":selected").val();
var selectedMonth=this.monthSelect.find(":selected").val();
var hasMore=0;
if(!selectedMonth&&!selectedYear&&this.nextYearToBeLoaded&&this.nextYearToBeLoaded>=this.data.startDate.getFullYear()){hasMore=1;
}var currScrollVal=this.shoveller.scrollLeft.call(this.shoveller);
var nextScrollVal=currScrollVal+this.shoveller.width();
var maxScrollWidth=this.shoveller.attr("scrollWidth");
if(maxScrollWidth>nextScrollVal||hasMore){this.toggleFading("next",1,1);
}else{this.toggleFading("next",0);
}if(currScrollVal>0){this.toggleFading("previous",1,-1);
}else{this.toggleFading("previous",0);
}};
EditionShoveller.prototype.toggleFading=function(id,enable,scrollDir){var element=jQuery("#"+id);
if(enable){var controller=this;
element.unbind("click");
element.click(function(){controller.navigationClicked(scrollDir,controller.shovellerEditions);
});
element.removeClass("shovellerDisable").addClass("shovellerEnable");
}else{element.unbind("click");
element.removeClass("shovellerEnable").addClass("shovellerDisable");
}};
EditionShoveller.prototype.getNewEditions=function(year){jQuery("#row_Editions_"+this.status+"_"+this.index).hide();
jQuery("#row_Editions_Loading_"+this.status+"_"+this.index).show();
var inputData={};
inputData["asin"]=this.subsAsin;
inputData["sid"]=mykJS.sessionId;
inputData["year"]=year;
Subscriptions.requestEditionsInCloud(inputData,"",this.index,this.status,this.data.pubFrequency,"fiona_magazine",1);
};
EditionShoveller.prototype.loadNewEditions=function(updateFromYear){this.scrollToPage=0;
var containerWidth=this.shoveller.width();
var currEditions=[];
var errorHtml;
var selectedYear=this.yearSelect.find(":selected").val();
var selectedMonth=this.monthSelect.find(":selected").val();
if(!selectedMonth&&!selectedYear){this.monthSelect.attr("disabled",true).css("opacity",0.4);
var loadFrom=this.data.endDate.getFullYear();
if(updateFromYear){loadFrom=updateFromYear;
}this.nextYearToBeLoaded="";
for(var j=loadFrom;
j>=this.data.startDate.getFullYear();
j--){if(!this.allEditions.hasOwnProperty(j)){this.nextYearToBeLoaded=j;
break;
}for(var i=12;
i>=1;
i--){if(this.allEditions[j].hasOwnProperty(i)){currEditions=currEditions.concat(this.allEditions[j][i]);
}}}}else{if(!selectedMonth){if(!this.allEditions.hasOwnProperty(selectedYear)){this.getNewEditions(selectedYear);
return;
}for(var i=12;
i>=1;
i--){var yearEditions=this.allEditions[selectedYear];
if(yearEditions.hasOwnProperty(i)){jQuery("#monthSelect_"+i).removeAttr("disabled").css("opacity",1);
currEditions=currEditions.concat(yearEditions[i]);
}else{jQuery("#monthSelect_"+i).attr("disabled",true).css("opacity",0.4);
}}if(currEditions.length){this.monthSelect.removeAttr("disabled").css("opacity",1);
}else{this.monthSelect.attr("disabled",true).css("opacity",0.4);
}}else{if(!selectedYear){errorHtml='<div style="text-align:center">'+mykJS.selectYearMsg+"</div>";
}else{if(!this.allEditions.hasOwnProperty(selectedYear)){this.getNewEditions(selectedYear);
return;
}var editionsFound=0;
for(var i=12;
i>=1;
i--){var yearEditions=this.allEditions[selectedYear];
if(yearEditions.hasOwnProperty(i)){editionsFound=1;
jQuery("#monthSelect_"+i).removeAttr("disabled").css("opacity",1);
if(selectedMonth==i){currEditions=yearEditions[i];
}}else{jQuery("#monthSelect_"+i).attr("disabled",true).css("opacity",0.4);
}}if(editionsFound){this.monthSelect.removeAttr("disabled").css("opacity",1);
}else{this.monthSelect.attr("disabled",true).css("opacity",0.4);
}}}}if(updateFromYear&&(!selectedMonth&&!selectedYear)){this.scrollToPage=Math.ceil(this.shovellerEditions.length/this.editionsPerPage);
if(this.shovellerEditions.length%this.editionsPerPage==0){this.scrollToPage++;
}this.shovellerEditions=this.shovellerEditions.concat(currEditions);
}else{this.shovellerEditions=currEditions;
}if(this.shovellerEditions&&this.shovellerEditions.length){var shovellerPages=0;
shovellerPages=Math.ceil(this.shovellerEditions.length/this.editionsPerPage);
var editionsHtml;
if(this.scrollToPage){editionsHtml=this.getEditionsHTML(this.shovellerEditions,(this.scrollToPage-1)*this.editionsPerPage);
}else{this.shovellerContainer.html("");
this.loadStatus=[];
editionsHtml=this.getEditionsHTML(this.shovellerEditions,0);
}this.shovellerContainer.append(editionsHtml);
containerWidth=shovellerPages*this.shoveller.width();
}else{this.shovellerContainer.html("");
if(!errorHtml){errorHtml='<div style="text-align:center">'+mykJS.noEditionAvailableMsg+"</div>";
}this.shovellerContainer.append(errorHtml);
}this.shovellerContainer.css("width",containerWidth);
if(this.scrollToPage){this.shoveller.scrollLeft.call(this.shoveller,(this.scrollToPage-1)*this.shoveller.width());
}else{this.shoveller.scrollLeft.call(this.shoveller,0);
}this.updateNavigationButtons();
};
EditionShoveller.prototype.onLoadScroll=function(){var shovellerPages=Math.ceil(this.shovellerEditions.length/this.editionsPerPage);
var controller=this;
setTimeout(function(){var containerWidth=shovellerPages?shovellerPages*controller.shoveller.width():controller.shoveller.width();
var scrollTo=0;
if(controller.scrollToPage){scrollTo=(controller.scrollToPage-1)*controller.shoveller.width();
}controller.shovellerContainer.css("width",containerWidth);
controller.shoveller.scrollLeft.call(controller.shoveller,scrollTo);
controller.updateNavigationButtons();
},1);
};
function FionaSync(){}FionaSync.ajax=new Ajax("/gp/digital/fiona/manage/features/sync/sync-submit.html");
FionaSync.click=function(status){FionaSync.newStatus=status;
window.clearTimeout(FionaSync.statusTimer);
document.getElementById("syncRequestStatus").style.display="";
document.getElementById("syncChangeOverlay").style.display="";
document.getElementById("syncRequestStatus").innerHTML=mykJS.kindle_myk_sync_processing_22938;
FionaSync.ajax.makeRequest("newStatus="+status+"&ajax=1&sid="+mykJS.sessionId,FionaSync.clickCallback);
};
FionaSync.clickCallback=function(data){var retVal=eval(data);
if(retVal=="page-requires-sign-in"){alert(mykJS.kindle_myk_sync_sign_in_83167);
document.location.href="/gp/digital/fiona/manage/sync";
return;
}else{if(retVal==1){document.getElementById("syncRequestStatus").style.display="none";
var statusText=document.getElementById("syncStatusText");
statusText.innerHTML=(FionaSync.newStatus==1)?mykJS.kindle_myk_sync_on_09578:mykJS.kindle_myk_sync_off_19285;
statusText.style.color=(FionaSync.newStatus==1)?"green":"red";
var nextNewStatus=(FionaSync.newStatus==1)?0:1;
if(nextNewStatus==1){document.getElementById("syncChangeLinkOff").style.display="none";
document.getElementById("syncChangeLinkOn").style.display="";
}else{document.getElementById("syncChangeLinkOff").style.display="";
document.getElementById("syncChangeLinkOn").style.display="none";
}}else{document.getElementById("syncRequestStatus").innerHTML=mykJS.kindle_myk_sync_failed_try_again_64459;
FionaSync.statusTimer=window.setTimeout(function(){document.getElementById("syncRequestStatus").style.display="none";
},2000);
}}document.getElementById("syncChangeOverlay").style.display="none";
};
function FionaAutoUpdate(){}FionaAutoUpdate.ajax=new Ajax("/gp/digital/fiona/du/autoUpdate-submit.html");
FionaAutoUpdate.click=function(status){FionaAutoUpdate.newStatus=status;
window.clearTimeout(FionaAutoUpdate.statusTimer);
jQuery("#autoUpdateRequestStatus").show();
jQuery("#autoUpdateChangeOverlay").show();
jQuery("#autoUpdateRequestStatus").text(mykJS.kindle_myk_sync_processing_22938);
FionaAutoUpdate.ajax.makeRequest("newStatus="+status+"&isAjax=1&sid="+mykJS.sessionId,FionaAutoUpdate.clickCallback);
};
FionaAutoUpdate.clickCallback=function(data){var retVal=eval(data);
if(retVal=="page-requires-sign-in"){alert(mykJS.kindle_myk_sync_sign_in_83167);
document.location.href="/gp/digital/fiona/manage/avu";
return;
}else{if(retVal==1){jQuery("#autoUpdateRequestStatus").hide();
var statusText=jQuery("#autoUpdateStatusText");
if(FionaAutoUpdate.newStatus==1){statusText.text(mykJS.kindle_myk_sync_on_09578);
statusText.css("color","green");
jQuery("#autoUpdateChangeLinkOff").show();
jQuery("#autoUpdateChangeLinkOn").hide();
}else{statusText.text(mykJS.kindle_myk_sync_off_19285);
statusText.css("color","red");
jQuery("#autoUpdateChangeLinkOff").hide();
jQuery("#autoUpdateChangeLinkOn").show();
}}else{jQuery("#autoUpdateRequestStatus").text(mykJS.kindle_myk_sync_failed_try_again_64459);
FionaAutoUpdate.statusTimer=window.setTimeout(function(){jQuery("#autoUpdateRequestStatus").hide();
},2000);
}}jQuery("#autoUpdateChangeOverlay").hide();
};
function ToDo(){this.oldIndex;
}ToDo.displayToDoList=function(){jQuery("#fionaToDoLoading").show();
var inputData={sid:mykJS.sessionId};
var t0_date;
if(window.ue){t0_date=new Date();
}mykJS.timedAjaxRequest("th_load","/gp/digital/fiona/du/getTodo.html",inputData,function(data,xmlResponse){ToDo.addToDoTable(data);
if(window.ue){var scope="todoCSM";
ues("t0",scope,t0_date);
ues("ctb",scope,"1");
requestId=xmlResponse.getResponseHeader("x-amz-id-1");
ues("id",scope,requestId);
uet("cf",scope);
uex("ld",scope);
}},1);
};
ToDo.addToDoTable=function(data){jQuery("#fionaToDoLoading").hide();
jQuery("#fionaToDoLoading").after(data.data);
amznJQ.declareAvailable("todoHistory");
};
function UtilitiesDom(){}UtilitiesDom.getWindowWidth=function(){var windowWidth;
if(self.innerHeight){windowWidth=self.innerWidth;
}else{if(document.documentElement&&document.documentElement.clientWidth){windowWidth=document.documentElement.clientWidth;
}else{if(document.body){windowWidth=document.body.clientWidth;
}}}return windowWidth;
};
UtilitiesDom.getWindowHeight=function(){var windowHeight;
if(self.innerHeight){windowHeight=self.innerHeight;
}else{if(document.documentElement&&document.documentElement.clientHeight){windowHeight=document.documentElement.clientHeight;
}else{if(document.body){windowHeight=document.body.clientHeight;
}}}return windowHeight;
};
UtilitiesDom.clearElement=function(elem){if(!elem){return;
}for(var i=elem.childNodes.length-1;
i>=0;
i--){elem.removeChild(elem.childNodes[i]);
}};
UtilitiesDom.stripWhitespaceNodes=function(elem){for(var i=elem.childNodes.length-1;
i>=0;
i--){var curNode=elem.childNodes[i];
if(curNode.nodeType==Node.ELEMENT_NODE||curNode.nodeType==Node.DOCUMENT_NODE||curNode.nodeType==Node.DOCUMENT_FRAGMENT_NODE){UtilitiesDom.stripWhitespaceNodes(curNode);
}else{if(curNode.nodeType==Node.COMMENT_NODE){elem.removeChild(curNode);
}else{if(curNode.nodeType==Node.TEXT_NODE){if(curNode.nodeValue==null||curNode.nodeValue.search(/^\s*$/)>=0){elem.removeChild(curNode);
}}}}}};
UtilitiesDom.findYPos=function(elem){var y=0;
if(elem==null){return y;
}if(elem.offsetParent){while(elem!=null){y+=elem.offsetTop;
elem=elem.offsetParent;
}}else{if(elem.y){y+=elem.y;
}}return y;
};
UtilitiesDom.findXPos=function(elem){var x=0;
if(elem.offsetParent){while(elem!=null){x+=elem.offsetLeft;
elem=elem.offsetParent;
}}else{if(elem.x){x+=elem.x;
}}return x;
};
UtilitiesDom.getStyle=function(elem,prop){var style;
if(window.getComputedStyle){style=document.defaultView.getComputedStyle(elem,null).getPropertyValue(prop);
}else{if(elem.currentStyle){style=elem.currentStyle[prop];
}}return style;
};
UtilitiesDom.show=function(){for(i=0;
i<arguments.length;
i++){var e=document.getElementById(arguments[i]);
if(e){e.style.display="";
}}};
UtilitiesDom.hide=function(){for(i=0;
i<arguments.length;
i++){var e=document.getElementById(arguments[i]);
if(e){e.style.display="none";
}}};
UtilitiesDom.clickedNode=function(event,node){if(node==null){return false;
}if(document.all){var t=window.event.srcElement;
while(t.parentElement!=null){if(t==node){return true;
}t=t.parentElement;
}return false;
}else{if(document.getElementById&&event){var t=event.target;
while(t.parentNode!=null){if(t==node){return true;
}t=t.parentNode;
}return false;
}else{return false;
}}};
UtilitiesDom.isEventInNode=function(event,node){if(node==null){return false;
}var t=event.relatedTarget;
while(t!=null&&t.parentNode!=null){if(t==node){return true;
}t=t.parentNode;
}return false;
};
UtilitiesDom.positionClickedDiv=function(relativeId,divId,relativeHow){var relativeObj=document.getElementById(relativeId);
if(!relativeObj){alert("Can not find relativeId "+relativeId);
return;
}var divToMove=document.getElementById(divId);
if(!divToMove){alert("Can not find div "+divId);
return;
}divToMove.style.display="block";
UtilitiesDom.positionDiv(relativeObj,divToMove,relativeHow);
return false;
};
UtilitiesDom.positionHoverDiv=function(relativeId,divId,relativeHow){var relativeObj=document.getElementById(relativeId);
if(!relativeObj){return;
}var divToMove=document.getElementById(divId);
if(!divToMove){return;
}divToMove.style.display="block";
UtilitiesDom.positionDiv(relativeObj,divToMove,relativeHow);
};
UtilitiesDom.positionDiv=function(relativeObj,divToMoveObj,relativeHow){if(typeof relativeObj=="string"){relativeObj=document.getElementById(relativeObj);
}var el=relativeObj;
var relativeX=0;
var relativeY=el.offsetHeight;
while(el.offsetParent&&el.tagName.toUpperCase()!="BODY"){relativeX+=el.offsetLeft;
relativeY+=el.offsetTop;
el=el.offsetParent;
}var divShowX=divToMoveObj.offsetWidth;
var divShowY=divToMoveObj.offsetHeight;
var extraX=0;
var extraY=0;
if(!relativeHow){relativeHow="top-left";
}switch(relativeHow){case"right":extraX=50;
extraY=(0-Math.floor(divShowY/2));
break;
case"top-right":extraX=30;
extraY=(0-divShowY);
break;
case"bottom-batch-middle":extraY=-20;
extraX=(Math.floor(relativeObj.offsetWidth/2)-Math.floor(divShowX/2));
break;
case"bottom-middle":extraX=(0-Math.floor(divShowX/2));
extraY=2;
break;
case"bottom-right":extraX=(0-Math.floor(relativeX/4));
extraY=Math.floor(divShowY/4);
break;
case"over-middle":extraX=(0-Math.floor(divShowX/2));
extraY=(0-Math.floor(divShowY/2));
break;
case"top-left":default:extraX=(0-divShowX);
extraY=(0-divShowY);
break;
}divToMoveObj.style.top=(relativeY+extraY)+"px";
divToMoveObj.style.left=(relativeX+extraX)+"px";
};
UtilitiesDom.popupTimerArray=new Object;
UtilitiesDom.leaveDiv=function(divId,timer){if(timer==null){timer=400;
}if(UtilitiesDom.popupTimerArray[divId]){clearTimeout(UtilitiesDom.popupTimerArray[divId]);
}UtilitiesDom.popupTimerArray[divId]=setTimeout(function(){document.getElementById(divId).style.display="none";
},timer);
};
UtilitiesDom.arriveDiv=function(divId,timer){if(timer==null){timer=0;
}if(UtilitiesDom.popupTimerArray[divId]){clearTimeout(UtilitiesDom.popupTimerArray[divId]);
}UtilitiesDom.popupTimerArray[divId]=setTimeout(function(){UtilitiesDom.show(divId);
},timer);
};
UtilitiesDom.documentOnclickStack=new Array();
UtilitiesDom.pushDocumentOnclick=function(onClickFunction){UtilitiesDom.documentOnclickStack.push(onClickFunction);
document.onclick=onClickFunction;
};
UtilitiesDom.popDocumentOnclick=function(){UtilitiesDom.documentOnclickStack.pop();
if(UtilitiesDom.documentOnclickStack.length>0){document.onclick=UtilitiesDom.documentOnclickStack[UtilitiesDom.documentOnclickStack.length-1];
}else{document.onclick="";
}};
function UtilitiesEvent(){}UtilitiesEvent.addEvent=function(eventName,elem,handler,iframeDocumentWindow){if(elem.addEventListener){elem.addEventListener(eventName,handler,false);
}else{if(elem.attachEvent){if(handler==null){return;
}var wrapper=function(){var e;
if(iframeDocumentWindow&&iframeDocumentWindow.event){e=iframeDocumentWindow.event;
}else{if(event){e=event;
}else{if(window.event){e=window.event;
}}}e.currentTarget=elem;
e.target=e.srcElement;
if(eventName=="mouseout"){e.relatedTarget=e.toElement;
}else{if(eventName=="mouseover"){e.relatedTarget=e.fromElement;
}}e.stopPropagation=function(){e.cancelBubble=true;
};
e.preventDefault=function(){e.returnValue=false;
};
return handler(e);
};
elem.events=elem.events||{};
elem.events[eventName]=wrapper;
elem.attachEvent("on"+eventName,wrapper);
}}};
UtilitiesEvent.removeEvent=function(eventName,elem,handler){if(elem.removeEventListener){elem.removeEventListener(eventName,handler,false);
}else{if(elem.detachEvent){if(elem.events&&elem.events[eventName]){elem.detachEvent("on"+eventName,elem.events[eventName]);
}}}};
(function(window,$,undefined){var KindleLibraryQueryData=function(){this.queryUrl="/gp/digital/fiona/manage/features/order-history/ajax/queryOwnership.html";
this.metric="ro_load";
this.count=0;
this.requestQueue=new Array();
this.pageSize=100;
this.maxNumberOfConcurrentCalls=5;
};
var YourKindleLibrary=function(){this.displaySize;
this.contentTypes;
this.contentSubTypeParentMap;
this.queryData=new Object();
this.queryData["All"]=new KindleLibraryQueryData();
this.queryData["Books"]=new KindleLibraryQueryData();
this.queryData["Newspapers"]=new KindleLibraryQueryData();
this.queryData["Magazines"]=new KindleLibraryQueryData();
this.queryData["Blogs"]=new KindleLibraryQueryData();
this.queryData["Audio Books"]=new KindleLibraryQueryData();
this.queryData["Personal Documents"]=new KindleLibraryQueryData();
this.queryData["Active Content"]=new KindleLibraryQueryData();
this.queryData["Your Apps"]=new KindleLibraryQueryData();
this.queryData["Amazon Instant Videos"]=new KindleLibraryQueryData();
};
YourKindleLibrary.prototype.loadContentType=function(contentType,donotupdate){if(!itemCache.contentLoadingStatus["All"]&&jQuery.inArray(contentType,this.contentTypes)!==-1){if(!itemCache.contentLoadingStatus[contentType]){this.requestContentByType(contentType,0,this.displaySize);
}}this.showAndHideFeatures(contentType);
filterList.filter(contentType,donotupdate);
};
YourKindleLibrary.prototype.requestContentByType=function(contentType,offset,size,queryToken){var inputData={};
inputData["offset"]=offset;
inputData["count"]=size;
inputData["contentType"]=contentType;
inputData["randomizer"]=new Date().getTime();
if(typeof queryToken==="undefined"){queryToken=0;
}inputData["queryToken"]=queryToken;
mykJS.timedAjaxRequest(this.queryData[contentType].metric,this.queryData[contentType].queryUrl,inputData,this.contentLoadingCallback);
itemCache.contentLoadingStatus[contentType]="loading";
if(contentType==="All"){for(var i in this.contentTypes){itemCache.contentLoadingStatus[this.contentTypes[i]]="loading";
}}};
YourKindleLibrary.prototype.toggleStillLoading=function(contentType){if(this.isLoading(contentType)){jQuery("#stillLoading").show();
}else{jQuery("#stillLoading").hide();
}};
YourKindleLibrary.prototype.isLoading=function(contentType){if(this.contentSubTypeParentMap[contentType]){contentType=this.contentSubTypeParentMap[contentType];
}if(contentType==="All"){for(var x in itemCache.contentLoadingStatus){if(itemCache.contentLoadingStatus[x]==="loading"){return true;
}}}return itemCache.contentLoadingStatus[contentType]==undefined||itemCache.contentLoadingStatus[contentType]==="loading";
};
YourKindleLibrary.prototype.isLoaded=function(contentType){return !this.isLoading(contentType);
};
YourKindleLibrary.prototype.showAndHideFeatures=function(type){if(type==="Personal Documents"){jQuery("#pdocs-usage-bar-ykl").show();
}else{jQuery("#pdocs-usage-bar-ykl").hide();
}};
YourKindleLibrary.prototype.showCrossLinks=function(type){jQuery("#sidebar_cross_links_panel").show();
};
YourKindleLibrary.prototype.showOrderListTable=function(type){document.getElementById("orderList").style.display="";
document.getElementById("orderListPage").style.display="";
document.getElementById("noOrderError").style.display="none";
};
YourKindleLibrary.prototype.hideOrderListTable=function(type){var itemType="";
if(type==="Books"){itemType=mykJS.kindle_myk_your_orders_filter_books_48201;
}else{if(type==="Newspapers"){itemType=mykJS.kindle_myk_your_orders_filter_newspapers_58039;
}else{if(type==="Magazines"){itemType=mykJS.kindle_myk_your_orders_filter_magazines_20182;
}else{if(type==="Blogs"){itemType=mykJS.kindle_myk_your_orders_filter_blogs;
}else{if(type==="Audio Books"){itemType=mykJS.kindle_myk_your_orders_filter_audible_audiobooks;
}else{if(type==="Active Content"){itemType=mykJS.kindle_myk_your_orders_filter_active_content;
}else{if(type==="Personal Documents"){itemType=mykJS.kindle_myk_your_orders_filter_personal_documents;
}else{if(type==="Your Apps"){itemType=mykJS.kindle_myk_your_orders_filter_your_apps;
}else{if(type==="Amazon Instant Videos"){itemType=mykJS.kindle_myk_your_orders_filter_aiv;
}}}}}}}}}document.getElementById("orderList").style.display="none";
document.getElementById("orderListPage").style.display="none";
var noOrderError=document.getElementById("noOrderError");
if(type&&this.isLoading(type)){var loadingMsg=mykJS.kindle_myk_recent_orders_loading_content;
noOrderError.innerHTML=loadingMsg.replace(/{TYPE}/g,itemType);
}else{var typeStr=itemType?itemType:mykJS.kindle_myk_recent_orders_type_all;
var innerText=mykJS.kindle_myk_recent_orders_no_orders_found;
noOrderError.innerHTML="<p>"+innerText.replace(/{TYPE}/g,typeStr)+"</p>";
}noOrderError.style.display="block";
this.hideOrderItemsCount();
};
YourKindleLibrary.prototype.showOrderItemsCount=function(){var startIdx;
var endIdx;
var total=pageList.totalItems;
if(total===0){this.hideOrderItemsCount();
return;
}else{startIdx=(pageList.currentPage-1)*pageList.pageSize+1;
endIdx=Math.min(startIdx+pageList.pageSize-1,total);
var itemCntDiv=document.getElementById("orderItemsCount");
var innerText=mykJS.kindle_myk_recent_orders_show_item_count;
innerText=innerText.replace(/{START}/g,startIdx);
innerText=innerText.replace(/{END}/g,endIdx);
innerText=innerText.replace(/{TOTAL}/g,total);
itemCntDiv.innerHTML="<p>"+innerText+"</p>";
itemCntDiv.style.display="block";
}};
YourKindleLibrary.prototype.hideOrderItemsCount=function(){document.getElementById("orderItemsCount").style.display="none";
};
YourKindleLibrary.prototype.donotUpdateTable=function(displaySize){var ordersTable=document.getElementById("orderList");
if(ordersTable.style.display==="none"){return 0;
}var rowCount=(jQuery("#orderListBody > tr").length-1)/3;
if(rowCount<displaySize){return 0;
}else{return 1;
}};
YourKindleLibrary.prototype.addFilter=function(value,id,text){var jqFilterSearch=jQuery("#filterSearch");
if(!addedSeparator){addedSeparator=true;
jqFilterSearch.append('<option disabled="disabled" id="separator">---------------</option>');
}jqFilterSearch.append(jQuery("<option></option>").attr({value:value,id:id}).text(text));
};
myk.YourKindleLibrary=YourKindleLibrary;
myk.KindleLibraryQueryData=KindleLibraryQueryData;
})(window,jQuery);
function Popover(){this.content="";
}function verifyNonVirtual(form){var selected=form.deviceID;
var selectedValue=selected.options[selected.selectedIndex].value;
if(selectedValue.charAt(selectedValue.length-1)==";"){alert(mykJS.kindle_myk_popover_select_another_29582);
return false;
}return true;
}Popover.prototype.DIV_ID="selectKindleBox";
Popover.prototype.CLASS_NAME="bluePopover";
Popover.prototype.TABLE_ID="orderListBody";
Popover.prototype.constructFramework=function(){this.createSelectKindleDiv();
UtilitiesEvent.addEvent("resize",window,Popover.prototype.moveDiv);
UtilitiesEvent.addEvent("mousedown",document.body,Popover.prototype.undisplay);
};
Popover.prototype.createSelectKindleDiv=function(){if(this.selectKindleDiv){return;
}this.selectKindleDiv=document.createElement("div");
this.selectKindleDiv.id=Popover.prototype.DIV_ID;
this.selectKindleDiv.className=Popover.prototype.CLASS_NAME;
this.moveDiv();
this.selectKindleDiv.style.display="none";
this.selectKindleDiv.style.position="absolute";
this.selectKindleDiv.style.width="430px";
var childToAppend=this.selectKindleDiv;
jQuery(window).ready(function(){document.body.appendChild(childToAppend);
});
};
Popover.prototype.createContent=function(asin,category){var itemData=itemCache.getDataByASIN(asin);
var capability=itemData.capability;
this.content='<div class="header">'+'<div class="left"></div>'+'<div class="middle"></div>'+'<div class="right"></div>'+"<h3>"+mykJS.downloadPopoverTitleStr+"</h3>"+'<div class="titleClose">'+'<a id="closeBut" onClick="selectKindle.undisplay();return false" href="#"> '+mykJS.kindle_myk_popover_close_21686+' <img border="0" align="absmiddle" src="'+closeImage+'" alt="'+mykJS.kindle_myk_popover_close_window_94875+'"/>'+"</a>"+"</div>"+"</div>"+'<div class="body">'+'<div class="outer">'+'<div class="inner">'+"<p style='padding-top:10px'>"+mykJS.downloadPopoverHeaderStr+"</p>"+"<span style='text-align: center;'><form action='/gp/digital/fiona/content-download/fiona-dl.html/ref=kinw_myk_ro_dl' onSubmit='return verifyNonVirtual(this);' method='get' name='fionaDL'>"+mykJS.csrfFormArgs+"<input type='hidden' name='type' value='"+category+"'>"+"<input id='fionaHiddenEditionSelect_"+asin+"' type='hidden' name='contentName' value='"+asin+"'>"+"<input type='hidden' name='dl.x' value='submit'/>"+"<div class='popupDeviceSelect' style='text-align: center;'>"+"<select class='fionaDeviceSelect' onchange='mykJS.log(\"ro_dl_dd\",\"cng\")' name='deviceID' id='fionaDeviceSelect_"+asin+"'>";
var fionaDevice=yourDevices.getDevices(downloadableOwnedFionas,capability);
yourDevices.removeExcludedDevices(fionaDevice,itemData);
for(var i=0;
i<ownedFionas.EBOK_PURCHASE_ALLOWED.length;
i++){var isValidDevice=0;
for(var j=0;
j<fionaDevice.length;
j++){if(ownedFionas.EBOK_PURCHASE_ALLOWED[i].accountID==fionaDevice[j].accountID){isValidDevice=1;
break;
}}if(category.indexOf("kdk")==0&&!isValidDevice){continue;
}this.content+="<option value='";
if(isValidDevice){this.content+=ownedFionas.EBOK_PURCHASE_ALLOWED[i].accountID;
}else{this.content+="' disabled='true";
}this.content+="'>"+ownedFionas.EBOK_PURCHASE_ALLOWED[i].name+"</option>";
}this.content+="</select></div>";
this.content+="<span class='popupDownload' style='text-align: center;'><input name='dl.x' value='submit' type='image'"+" src='"+downloadButton+"'></span>";
this.content+="</form></span>"+mykJS.downloadPopoverFooterStr+"</div>"+"</div>"+"</div>"+'<div class="foot">'+'<div class="left"></div>'+'<div class="middle"></div>'+'<div class="right"></div>'+"</div>";
};
Popover.prototype.moveDiv=function(rowid){var selectKindleDiv=document.getElementById(Popover.prototype.DIV_ID);
if(!selectKindleDiv){return;
}var row=document.getElementById(rowid);
var computedLeft=Math.round(UtilitiesDom.getWindowWidth()/2)-425;
selectKindleDiv.style.left=computedLeft>=0?computedLeft:0;
selectKindleDiv.style.top=UtilitiesDom.findYPos(row)-40+"px";
};
Popover.prototype.showDropDown=function(rowcount,asin,category,rowid){var selectBox=parent.document.getElementById("downloadOptionSelect"+rowcount);
selectBox.selectedIndex=0;
this.show(asin,category,rowid);
};
Popover.prototype.show=function(asin,category,rowid){this.moveDiv(rowid);
this.createContent(asin,category);
var skDiv=parent.document.getElementById(Popover.prototype.DIV_ID);
skDiv.innerHTML=this.content;
skDiv.style.display="block";
};
Popover.prototype.undisplay=function(evnt){var selectDiv=document.getElementById(Popover.prototype.DIV_ID);
if(selectDiv&&(!evnt||!UtilitiesDom.clickedNode(evnt,selectDiv))){selectDiv.innerHTML="";
selectDiv.style.display="none";
}};
Popover.prototype.sendDropDown=function(asin,rowcount,kindleID){var selectBox=parent.document.getElementById("downloadOptionSelect"+rowcount);
var kindleName=selectBox.options[selectBox.selectedIndex].text;
var inputDevice=document.createElement("input");
inputDevice.setAttribute("type","hidden");
inputDevice.setAttribute("id","fiona_"+asin);
inputDevice.setAttribute("value",kindleID);
var form=selectBox.parentNode;
form.appendChild(inputDevice);
Fion.sendSingleItem(asin,kindleName);
form.removeChild(inputDevice);
selectBox.selectedIndex=0;
};
Popover.prototype.downloadDropDown=function(rowcount,kindleID){var selectBox=parent.document.getElementById("downloadOptionSelect"+rowcount);
var inputDevice=document.createElement("input");
inputDevice.setAttribute("type","hidden");
inputDevice.setAttribute("name","deviceID");
inputDevice.setAttribute("value",kindleID);
var inputDL=document.createElement("input");
inputDL.setAttribute("type","hidden");
inputDL.setAttribute("name","dl.x");
inputDL.setAttribute("value","submit");
var form=selectBox.parentNode;
form.appendChild(inputDevice);
form.appendChild(inputDL);
form.submit();
form.removeChild(inputDevice);
form.removeChild(inputDL);
selectBox.selectedIndex=0;
};
function Fion(){}Fion.ajaxObj=new Ajax("/gp/digital/fiona/content-download/fiona-ajax.html/ref=kinw_myk_ro_send");
Fion.gufsAjaxObj=new Ajax("/gp/digital/fiona/du/fiona-delete.html");
Fion.sendSingleItem=function(){};
Fion.sendSingleItem2=function(contentName){var sendingBoxId="singleItemSend2_"+contentName;
var sendingBox=document.getElementById(sendingBoxId);
sendingBox.innerHTML=mykJS.kindle_myk_popover_sending_60987;
sendingBox.style.display="block";
var deviceValue;
var device=document.getElementById("fionaDeviceSelect_"+contentName);
if(device!=null){deviceValue=device.options[device.selectedIndex].value;
}else{device=document.getElementById("fionaHiddenDeviceSelect_"+contentName);
deviceValue=device.value;
}Fion.sendToDevice(contentName,deviceValue,sendingBoxId);
};
Fion.showActionMsgRow=function(sendBoxId){var actionMsgRow=this.getActionMsgRow(sendBoxId);
actionMsgRow.style.display="";
};
Fion.getActionMsgRow=function(sendBoxId){return document.getElementById(sendBoxId).parentNode.parentNode;
};
Fion.sendSingleItem=function(contentName,kindleName){var sendingBoxId="singleItemSend_"+contentName;
var sendingBox=document.getElementById(sendingBoxId);
sendingBox.innerHTML=mykJS.kindle_myk_popover_sending_60987;
this.showActionMsgRow(sendingBoxId);
sendingBox.style.display="block";
var device=document.getElementById("fiona_"+contentName).value;
Fion.sendToDevice(contentName,device,sendingBoxId,kindleName);
};
Fion.sendToDevice=function(contentName,device,messageId,kindleName){var callback=function(resp){var object;
try{object=eval("("+resp+")");
}catch(e){return;
}var msg;
if(object.error){msg="<span style="+amznJQ.chars.DQUOTE+"color: #f00;"+amznJQ.chars.DQUOTE+">"+object.error+"</span>";
}else{if(isSizeGreaterThan50Mb){msg="<span style="+amznJQ.chars.DQUOTE+"color: #f00;"+amznJQ.chars.DQUOTE+">"+mykJS.kindle_myk_popover_sent_success_for_greater_50mb+"</span>";
}else{msg=mykJS.kindle_myk_popover_send_success_6929+" "+kindleName;
}}var sendMsgBox=document.getElementById(messageId);
var actionMsgRowId=sendMsgBox.parentNode.parentNode.getAttribute("id");
sendMsgBox.innerHTML=msg;
window.setTimeout(function(){UtilitiesDom.hide(messageId);
UtilitiesDom.hide(actionMsgRowId);
},mykJS.fadeOut);
};
var itemData=itemCache.getDataByASIN(contentName);
var category=itemData.category;
var title=itemData.title;
var contentNameFull=contentName;
var isSizeGreaterThan50Mb=itemData.isSizeGreaterThan50Mb;
Fion.ajaxObj.makeRequest("isAjax=1"+"&deviceID="+device+"&contentName="+contentName+"&category="+category+"&title="+title,callback);
};
amznJQ.declareAvailable("mykJS");
function KTResizeRightSpacer(leftMargin){jQuery(".kindleTab-right-spacer").each(function(){var parentSize=jQuery(this).parent().parent().parent().parent().parent().width();
jQuery(this).width(parentSize-leftMargin);
});
}function KTActivateTab(tabId,contentId,containerId){containerId="#"+containerId;
tabId="#"+tabId;
contentId="#"+contentId;
jQuery(containerId+" .kindleTab-active-tab").addClass("kindleTab-inactive-tab").removeClass("kindleTab-active-tab").children(".secondary").addClass("primary").removeClass("secondary");
jQuery(containerId+" "+tabId).addClass("kindleTab-active-tab").removeClass("kindleTab-inactive-tab").children(".primary").addClass("secondary").removeClass("primary");
jQuery(containerId+" .kindleTab-active-content").addClass("kindleTab-inactive").removeClass("kindleTab-active-content");
jQuery(containerId+" "+contentId).addClass("kindleTab-active-content").removeClass("kindleTab-inactive");
}